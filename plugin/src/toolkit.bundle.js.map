{
  "version": 3,
  "sources": ["toolkit.js", "../../node_modules/zotero-plugin-toolkit/dist/chunk-Cl8Af3a2.js", "../../node_modules/zotero-plugin-toolkit/dist/index.js"],
  "sourcesContent": ["/**\n * Zotero Plugin Toolkit wrapper module\n * This file imports and exposes the toolkit for use in the plugin\n */\n\nimport { BasicTool, UITool, ProgressWindowHelper } from 'zotero-plugin-toolkit';\n\n/**\n * Initialize and return toolkit instance\n * @param {object} config - Plugin configuration\n * @param {string} config.id - Plugin ID\n * @param {string} config.version - Plugin version\n * @param {string} config.rootURI - Plugin root URI\n * @returns {object} Toolkit instance with helpers\n */\nexport function createToolkit(config) {\n\tconst basicTool = new BasicTool();\n\tconst uiTool = new UITool();\n\tconst progressHelper = new ProgressWindowHelper(config.id, 'Zotero RAG');\n\n\treturn {\n\t\tbasicTool,\n\t\tuiTool,\n\t\tprogressHelper,\n\n\t\t/**\n\t\t * Show an alert dialog using Services.prompt\n\t\t * @param {string} message - Dialog message\n\t\t */\n\t\tshowAlert(message) {\n\t\t\tServices.prompt.alert(null, 'Zotero RAG', message);\n\t\t},\n\n\t\t/**\n\t\t * Show an error dialog using Services.prompt\n\t\t * @param {string} message - Error message\n\t\t */\n\t\tshowError(message) {\n\t\t\tServices.prompt.alert(null, 'Zotero RAG Error', message);\n\t\t},\n\n\t\t/**\n\t\t * Show a progress notification\n\t\t * @param {string} message - Message to display\n\t\t * @param {string} type - Type of notification: 'success', 'error', or 'default'\n\t\t */\n\t\tshowNotification(message, type = 'default') {\n\t\t\tnew progressHelper.createLine({\n\t\t\t\ttext: message,\n\t\t\t\ttype: type,\n\t\t\t\tprogress: 100,\n\t\t\t}).show();\n\t\t}\n\t};\n}\n", "//#region rolldown:runtime\nvar __defProp = Object.defineProperty;\nvar __export = (target, all) => {\n\tfor (var name in all) __defProp(target, name, {\n\t\tget: all[name],\n\t\tenumerable: true\n\t});\n};\n\n//#endregion\nexport { __export };", "import { __export } from \"./chunk-Cl8Af3a2.js\";\n\n//#region package.json\nvar version = \"5.1.0-beta.12\";\n\n//#endregion\n//#region src/utils/debugBridge.ts\n/**\n* Debug bridge.\n*\n* @deprecated Since this is a temporary solution for debugging, it is not recommended to use.\n* The zotero-plugin-scaffold no longer need this.\n*\n* @remarks\n* Global variables: Zotero, window(main window).\n*\n* @example\n* Run script directly. The `run` is URIencoded script.\n*\n* `zotero://ztoolkit-debug/?run=Zotero.getMainWindow().alert(%22HelloWorld!%22)&app=developer`\n* @example\n* Run script from file. The `file` is URIencoded path to js file starts with `file:///`\n*\n* `zotero://ztoolkit-debug/?file=file%3A%2F%2F%2FC%3A%2FUsers%2Fw_xia%2FDesktop%2Frun.js&app=developer`\n*/\nvar DebugBridge = class DebugBridge {\n\tstatic version = 2;\n\tstatic passwordPref = \"extensions.zotero.debug-bridge.password\";\n\tget version() {\n\t\treturn DebugBridge.version;\n\t}\n\t_disableDebugBridgePassword;\n\tget disableDebugBridgePassword() {\n\t\treturn this._disableDebugBridgePassword;\n\t}\n\tset disableDebugBridgePassword(value) {\n\t\tthis._disableDebugBridgePassword = value;\n\t}\n\tget password() {\n\t\treturn BasicTool.getZotero().Prefs.get(DebugBridge.passwordPref, true);\n\t}\n\tset password(v) {\n\t\tBasicTool.getZotero().Prefs.set(DebugBridge.passwordPref, v, true);\n\t}\n\tconstructor() {\n\t\tthis._disableDebugBridgePassword = false;\n\t\tthis.initializeDebugBridge();\n\t}\n\tstatic setModule(instance) {\n\t\tif (!instance.debugBridge?.version || instance.debugBridge.version < DebugBridge.version) instance.debugBridge = new DebugBridge();\n\t}\n\tinitializeDebugBridge() {\n\t\tconst debugBridgeExtension = {\n\t\t\tnoContent: true,\n\t\t\tdoAction: async (uri) => {\n\t\t\t\tconst Zotero$1 = BasicTool.getZotero();\n\t\t\t\tconst window$1 = Zotero$1.getMainWindow();\n\t\t\t\tconst uriString = uri.spec.split(\"//\").pop();\n\t\t\t\tif (!uriString) return;\n\t\t\t\tconst params = {};\n\t\t\t\turiString.split(\"?\").pop()?.split(\"&\").forEach((p) => {\n\t\t\t\t\tparams[p.split(\"=\")[0]] = decodeURIComponent(p.split(\"=\")[1]);\n\t\t\t\t});\n\t\t\t\tconst skipPasswordCheck = toolkitGlobal_default.getInstance()?.debugBridge.disableDebugBridgePassword;\n\t\t\t\tlet allowed = false;\n\t\t\t\tif (skipPasswordCheck) allowed = true;\n\t\t\t\telse if (typeof params.password === \"undefined\" && typeof this.password === \"undefined\") allowed = window$1.confirm(`External App ${params.app} wants to execute command without password.\\nCommand:\\n${(params.run || params.file || \"\").slice(0, 100)}\\nIf you do not know what it is, please click Cancel to deny.`);\n\t\t\t\telse allowed = this.password === params.password;\n\t\t\t\tif (allowed) {\n\t\t\t\t\tif (params.run) try {\n\t\t\t\t\t\tconst AsyncFunction = Object.getPrototypeOf(async () => {}).constructor;\n\t\t\t\t\t\tconst f = new AsyncFunction(\"Zotero,window\", params.run);\n\t\t\t\t\t\tawait f(Zotero$1, window$1);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tZotero$1.debug(e);\n\t\t\t\t\t\twindow$1.console.log(e);\n\t\t\t\t\t}\n\t\t\t\t\tif (params.file) try {\n\t\t\t\t\t\tServices.scriptloader.loadSubScript(params.file, {\n\t\t\t\t\t\t\tZotero: Zotero$1,\n\t\t\t\t\t\t\twindow: window$1\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tZotero$1.debug(e);\n\t\t\t\t\t\twindow$1.console.log(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tnewChannel(uri) {\n\t\t\t\tthis.doAction(uri);\n\t\t\t}\n\t\t};\n\t\tServices.io.getProtocolHandler(\"zotero\").wrappedJSObject._extensions[\"zotero://ztoolkit-debug\"] = debugBridgeExtension;\n\t}\n};\n\n//#endregion\n//#region src/utils/pluginBridge.ts\n/**\n* Plugin bridge. Install plugin from zotero://plugin\n*\n* @deprecated Since this is a temporary solution for debugging, it is not recommended to use.\n* The zotero-plugin-scaffold no longer need this.\n*\n* @example\n* Install plugin from url, with minimal Zotero version requirement.\n* ```text\n* zotero://plugin/?action=install&url=https%3A%2F%2Fgithub.com%2FMuiseDestiny%2Fzotero-style%2Freleases%2Fdownload%2F3.0.5%2Fzotero-style.xpi&minVersion=6.999\n* ```\n*/\nvar PluginBridge = class PluginBridge {\n\tstatic version = 1;\n\tget version() {\n\t\treturn PluginBridge.version;\n\t}\n\tconstructor() {\n\t\tthis.initializePluginBridge();\n\t}\n\tstatic setModule(instance) {\n\t\tif (!instance.pluginBridge?.version || instance.pluginBridge.version < PluginBridge.version) instance.pluginBridge = new PluginBridge();\n\t}\n\tinitializePluginBridge() {\n\t\tconst { AddonManager } = _importESModule(\"resource://gre/modules/AddonManager.sys.mjs\");\n\t\tconst Zotero$1 = BasicTool.getZotero();\n\t\tconst pluginBridgeExtension = {\n\t\t\tnoContent: true,\n\t\t\tdoAction: async (uri) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst uriString = uri.spec.split(\"//\").pop();\n\t\t\t\t\tif (!uriString) return;\n\t\t\t\t\tconst params = {};\n\t\t\t\t\turiString.split(\"?\").pop()?.split(\"&\").forEach((p) => {\n\t\t\t\t\t\tparams[p.split(\"=\")[0]] = decodeURIComponent(p.split(\"=\")[1]);\n\t\t\t\t\t});\n\t\t\t\t\tif (params.action === \"install\" && params.url) {\n\t\t\t\t\t\tif (params.minVersion && Services.vc.compare(Zotero$1.version, params.minVersion) < 0 || params.maxVersion && Services.vc.compare(Zotero$1.version, params.maxVersion) > 0) throw new Error(`Plugin is not compatible with Zotero version ${Zotero$1.version}.The plugin requires Zotero version between ${params.minVersion} and ${params.maxVersion}.`);\n\t\t\t\t\t\tconst addon = await AddonManager.getInstallForURL(params.url);\n\t\t\t\t\t\tif (addon && addon.state === AddonManager.STATE_AVAILABLE) {\n\t\t\t\t\t\t\taddon.install();\n\t\t\t\t\t\t\thint(\"Plugin installed successfully.\", true);\n\t\t\t\t\t\t} else throw new Error(`Plugin ${params.url} is not available.`);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tZotero$1.logError(e);\n\t\t\t\t\thint(e.message, false);\n\t\t\t\t}\n\t\t\t},\n\t\t\tnewChannel(uri) {\n\t\t\t\tthis.doAction(uri);\n\t\t\t}\n\t\t};\n\t\tServices.io.getProtocolHandler(\"zotero\").wrappedJSObject._extensions[\"zotero://plugin\"] = pluginBridgeExtension;\n\t}\n};\nfunction hint(content, success) {\n\tconst progressWindow = new Zotero.ProgressWindow({ closeOnClick: true });\n\tprogressWindow.changeHeadline(\"Plugin Toolkit\");\n\tprogressWindow.progress = new progressWindow.ItemProgress(success ? \"chrome://zotero/skin/tick.png\" : \"chrome://zotero/skin/cross.png\", content);\n\tprogressWindow.progress.setProgress(100);\n\tprogressWindow.show();\n\tprogressWindow.startCloseTimer(5e3);\n}\n\n//#endregion\n//#region src/managers/toolkitGlobal.ts\n/**\n* The Singleton class of global parameters used by managers.\n* @example `ToolkitGlobal.getInstance().itemTree.state`\n*/\nvar ToolkitGlobal = class ToolkitGlobal {\n\tdebugBridge;\n\tpluginBridge;\n\tprompt;\n\tcurrentWindow;\n\tconstructor() {\n\t\tinitializeModules(this);\n\t\tthis.currentWindow = BasicTool.getZotero().getMainWindow();\n\t}\n\t/**\n\t* Get the global unique instance of `class ToolkitGlobal`.\n\t* @returns An instance of `ToolkitGlobal`.\n\t*/\n\tstatic getInstance() {\n\t\tlet _Zotero;\n\t\ttry {\n\t\t\tif (typeof Zotero !== \"undefined\") _Zotero = Zotero;\n\t\t\telse _Zotero = BasicTool.getZotero();\n\t\t} catch {}\n\t\tif (!_Zotero) return void 0;\n\t\tlet requireInit = false;\n\t\tif (!(\"_toolkitGlobal\" in _Zotero)) {\n\t\t\t_Zotero._toolkitGlobal = new ToolkitGlobal();\n\t\t\trequireInit = true;\n\t\t}\n\t\tconst currentGlobal = _Zotero._toolkitGlobal;\n\t\tif (currentGlobal.currentWindow !== _Zotero.getMainWindow()) {\n\t\t\tcheckWindowDependentModules(currentGlobal);\n\t\t\trequireInit = true;\n\t\t}\n\t\tif (requireInit) initializeModules(currentGlobal);\n\t\treturn currentGlobal;\n\t}\n};\n/**\n* Initialize global modules using the data of this toolkit build.\n* Modules and their properties that do not exist will be updated.\n* @param instance ToolkitGlobal instance\n*/\nfunction initializeModules(instance) {\n\tnew BasicTool().log(\"Initializing ToolkitGlobal modules\");\n\tsetModule(instance, \"prompt\", {\n\t\t_ready: false,\n\t\tinstance: void 0\n\t});\n\tDebugBridge.setModule(instance);\n\tPluginBridge.setModule(instance);\n}\nfunction setModule(instance, key, module) {\n\tif (!module) return;\n\tif (!instance[key]) instance[key] = module;\n\tfor (const moduleKey in module) instance[key][moduleKey] ??= module[moduleKey];\n}\nfunction checkWindowDependentModules(instance) {\n\tinstance.currentWindow = BasicTool.getZotero().getMainWindow();\n\tinstance.prompt = void 0;\n}\nvar toolkitGlobal_default = ToolkitGlobal;\n\n//#endregion\n//#region src/basic.ts\n/**\n* Basic APIs with Zotero 6 & newer (7) compatibility.\n* See also https://www.zotero.org/support/dev/zotero_7_for_developers\n*/\nvar BasicTool = class BasicTool {\n\t/**\n\t* configurations.\n\t*/\n\t_basicOptions;\n\t_console;\n\t/**\n\t* @deprecated Use `patcherManager` instead.\n\t*/\n\tpatchSign = \"zotero-plugin-toolkit@3.0.0\";\n\tstatic _version = version;\n\t/**\n\t* Get version - checks subclass first, then falls back to parent\n\t*/\n\tget _version() {\n\t\treturn version;\n\t}\n\tget basicOptions() {\n\t\treturn this._basicOptions;\n\t}\n\t/**\n\t*\n\t* @param data Pass an BasicTool instance to copy its options.\n\t*/\n\tconstructor(data) {\n\t\tthis._basicOptions = {\n\t\t\tlog: {\n\t\t\t\t_type: \"toolkitlog\",\n\t\t\t\tdisableConsole: false,\n\t\t\t\tdisableZLog: false,\n\t\t\t\tprefix: \"\"\n\t\t\t},\n\t\t\tget debug() {\n\t\t\t\tif (this._debug) return this._debug;\n\t\t\t\tthis._debug = toolkitGlobal_default.getInstance()?.debugBridge || {\n\t\t\t\t\tdisableDebugBridgePassword: false,\n\t\t\t\t\tpassword: \"\"\n\t\t\t\t};\n\t\t\t\treturn this._debug;\n\t\t\t},\n\t\t\tapi: { pluginID: \"zotero-plugin-toolkit@windingwind.com\" },\n\t\t\tlisteners: {\n\t\t\t\tcallbacks: {\n\t\t\t\t\tonMainWindowLoad: /* @__PURE__ */ new Set(),\n\t\t\t\t\tonMainWindowUnload: /* @__PURE__ */ new Set(),\n\t\t\t\t\tonPluginUnload: /* @__PURE__ */ new Set()\n\t\t\t\t},\n\t\t\t\t_mainWindow: void 0,\n\t\t\t\t_plugin: void 0\n\t\t\t}\n\t\t};\n\t\ttry {\n\t\t\tif (typeof globalThis.ChromeUtils?.importESModule !== \"undefined\" || typeof globalThis.ChromeUtils?.import !== \"undefined\") {\n\t\t\t\tconst { ConsoleAPI } = _importESModule(\"resource://gre/modules/Console.sys.mjs\");\n\t\t\t\tthis._console = new ConsoleAPI({ consoleID: `${this._basicOptions.api.pluginID}-${Date.now()}` });\n\t\t\t}\n\t\t} catch {}\n\t\tthis.updateOptions(data);\n\t}\n\tgetGlobal(k) {\n\t\tif (typeof globalThis[k] !== \"undefined\") return globalThis[k];\n\t\tconst _Zotero = BasicTool.getZotero();\n\t\ttry {\n\t\t\tconst window$1 = _Zotero.getMainWindow();\n\t\t\tswitch (k) {\n\t\t\t\tcase \"Zotero\":\n\t\t\t\tcase \"zotero\": return _Zotero;\n\t\t\t\tcase \"window\": return window$1;\n\t\t\t\tcase \"windows\": return _Zotero.getMainWindows();\n\t\t\t\tcase \"document\": return window$1.document;\n\t\t\t\tcase \"ZoteroPane\":\n\t\t\t\tcase \"ZoteroPane_Local\": return _Zotero.getActiveZoteroPane();\n\t\t\t\tdefault: return window$1[k];\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tZotero.logError(e);\n\t\t}\n\t}\n\t/**\n\t* If it's an XUL element\n\t* @param elem\n\t*/\n\tisXULElement(elem) {\n\t\treturn elem.namespaceURI === \"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\";\n\t}\n\t/**\n\t* Create an XUL element\n\t*\n\t* For Zotero 6, use `createElementNS`;\n\t*\n\t* For Zotero 7+, use `createXULElement`.\n\t* @param doc\n\t* @param type\n\t* @example\n\t* Create a `<menuitem>`:\n\t* ```ts\n\t* const compat = new ZoteroCompat();\n\t* const doc = compat.getWindow().document;\n\t* const elem = compat.createXULElement(doc, \"menuitem\");\n\t* ```\n\t*/\n\tcreateXULElement(doc, type) {\n\t\treturn doc.createXULElement(type);\n\t}\n\t/**\n\t* Output to both Zotero.debug and console.log\n\t* @param data e.g. string, number, object, ...\n\t*/\n\tlog(...data) {\n\t\tif (data.length === 0) return;\n\t\tlet _Zotero;\n\t\ttry {\n\t\t\tif (typeof Zotero !== \"undefined\") _Zotero = Zotero;\n\t\t\telse _Zotero = BasicTool.getZotero();\n\t\t} catch {}\n\t\tlet options;\n\t\tif (data[data.length - 1]?._type === \"toolkitlog\") options = data.pop();\n\t\telse options = this._basicOptions.log;\n\t\ttry {\n\t\t\tif (options.prefix) data.splice(0, 0, options.prefix);\n\t\t\tif (!options.disableConsole) {\n\t\t\t\tlet _console;\n\t\t\t\tif (typeof console !== \"undefined\") _console = console;\n\t\t\t\telse if (_Zotero) _console = _Zotero.getMainWindow()?.console;\n\t\t\t\tif (!_console) {\n\t\t\t\t\tif (!this._console) return;\n\t\t\t\t\t_console = this._console;\n\t\t\t\t}\n\t\t\t\tif (_console.groupCollapsed) _console.groupCollapsed(...data);\n\t\t\t\telse _console.group(...data);\n\t\t\t\t_console.trace();\n\t\t\t\t_console.groupEnd();\n\t\t\t}\n\t\t\tif (!options.disableZLog) {\n\t\t\t\tif (typeof _Zotero === \"undefined\") return;\n\t\t\t\t_Zotero.debug(data.map((d) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn typeof d === \"object\" ? JSON.stringify(d) : String(d);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t_Zotero.debug(d);\n\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t}\n\t\t\t\t}).join(\"\\n\"));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (_Zotero) Zotero.logError(e);\n\t\t\telse console.error(e);\n\t\t}\n\t}\n\t/**\n\t* Patch a function\n\t* @deprecated Use {@link PatchHelper} instead.\n\t* @param object The owner of the function\n\t* @param funcSign The signature of the function(function name)\n\t* @param ownerSign The signature of patch owner to avoid patching again\n\t* @param patcher The new wrapper of the patched function\n\t*/\n\tpatch(object, funcSign, ownerSign, patcher) {\n\t\tif (object[funcSign][ownerSign]) throw new Error(`${String(funcSign)} re-patched`);\n\t\tthis.log(\"patching\", funcSign, `by ${ownerSign}`);\n\t\tobject[funcSign] = patcher(object[funcSign]);\n\t\tobject[funcSign][ownerSign] = true;\n\t}\n\t/**\n\t* Add a Zotero event listener callback\n\t* @param type Event type\n\t* @param callback Event callback\n\t*/\n\taddListenerCallback(type, callback) {\n\t\tif ([\"onMainWindowLoad\", \"onMainWindowUnload\"].includes(type)) this._ensureMainWindowListener();\n\t\tif (type === \"onPluginUnload\") this._ensurePluginListener();\n\t\tthis._basicOptions.listeners.callbacks[type].add(callback);\n\t}\n\t/**\n\t* Remove a Zotero event listener callback\n\t* @param type Event type\n\t* @param callback Event callback\n\t*/\n\tremoveListenerCallback(type, callback) {\n\t\tthis._basicOptions.listeners.callbacks[type].delete(callback);\n\t\tthis._ensureRemoveListener();\n\t}\n\t/**\n\t* Remove all Zotero event listener callbacks when the last callback is removed.\n\t*/\n\t_ensureRemoveListener() {\n\t\tconst { listeners } = this._basicOptions;\n\t\tif (listeners._mainWindow && listeners.callbacks.onMainWindowLoad.size === 0 && listeners.callbacks.onMainWindowUnload.size === 0) {\n\t\t\tServices.wm.removeListener(listeners._mainWindow);\n\t\t\tdelete listeners._mainWindow;\n\t\t}\n\t\tif (listeners._plugin && listeners.callbacks.onPluginUnload.size === 0) {\n\t\t\tZotero.Plugins.removeObserver(listeners._plugin);\n\t\t\tdelete listeners._plugin;\n\t\t}\n\t}\n\t/**\n\t* Ensure the main window listener is registered.\n\t*/\n\t_ensureMainWindowListener() {\n\t\tif (this._basicOptions.listeners._mainWindow) return;\n\t\tconst mainWindowListener = {\n\t\t\tonOpenWindow: (xulWindow) => {\n\t\t\t\tconst domWindow = xulWindow.docShell.domWindow;\n\t\t\t\tconst onload = async () => {\n\t\t\t\t\tdomWindow.removeEventListener(\"load\", onload, false);\n\t\t\t\t\tif (domWindow.location.href !== \"chrome://zotero/content/zoteroPane.xhtml\") return;\n\t\t\t\t\tfor (const cbk of this._basicOptions.listeners.callbacks.onMainWindowLoad) try {\n\t\t\t\t\t\tcbk(domWindow);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.log(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tdomWindow.addEventListener(\"load\", () => onload(), false);\n\t\t\t},\n\t\t\tonCloseWindow: async (xulWindow) => {\n\t\t\t\tconst domWindow = xulWindow.docShell.domWindow;\n\t\t\t\tif (domWindow.location.href !== \"chrome://zotero/content/zoteroPane.xhtml\") return;\n\t\t\t\tfor (const cbk of this._basicOptions.listeners.callbacks.onMainWindowUnload) try {\n\t\t\t\t\tcbk(domWindow);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.log(e);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis._basicOptions.listeners._mainWindow = mainWindowListener;\n\t\tServices.wm.addListener(mainWindowListener);\n\t}\n\t/**\n\t* Ensure the plugin listener is registered.\n\t*/\n\t_ensurePluginListener() {\n\t\tif (this._basicOptions.listeners._plugin) return;\n\t\tconst pluginListener = { shutdown: (...args) => {\n\t\t\tfor (const cbk of this._basicOptions.listeners.callbacks.onPluginUnload) try {\n\t\t\t\tcbk(...args);\n\t\t\t} catch (e) {\n\t\t\t\tthis.log(e);\n\t\t\t}\n\t\t} };\n\t\tthis._basicOptions.listeners._plugin = pluginListener;\n\t\tZotero.Plugins.addObserver(pluginListener);\n\t}\n\tupdateOptions(source) {\n\t\tif (!source) return this;\n\t\tif (source instanceof BasicTool) this._basicOptions = source._basicOptions;\n\t\telse this._basicOptions = source;\n\t\treturn this;\n\t}\n\tstatic getZotero() {\n\t\tif (typeof Zotero !== \"undefined\") return Zotero;\n\t\tconst { Zotero: _Zotero } = ChromeUtils.importESModule(\"chrome://zotero/content/zotero.mjs\");\n\t\treturn _Zotero;\n\t}\n};\nvar ManagerTool = class extends BasicTool {\n\t_ensureAutoUnregisterAll() {\n\t\tthis.addListenerCallback(\"onPluginUnload\", (params, _reason) => {\n\t\t\tif (params.id !== this.basicOptions.api.pluginID) return;\n\t\t\tthis.unregisterAll();\n\t\t});\n\t}\n};\nfunction unregister(tools) {\n\tObject.values(tools).forEach((tool) => {\n\t\tif (tool instanceof ManagerTool || typeof tool?.unregisterAll === \"function\") tool.unregisterAll();\n\t});\n}\nfunction makeHelperTool(cls, options) {\n\treturn new Proxy(cls, { construct(target, args) {\n\t\tconst _origin = new cls(...args);\n\t\tif (_origin instanceof BasicTool) _origin.updateOptions(options);\n\t\telse _origin._version = BasicTool._version;\n\t\treturn _origin;\n\t} });\n}\nfunction _importESModule(path) {\n\tif (typeof ChromeUtils.import === \"undefined\") return ChromeUtils.importESModule(path, { global: \"contextual\" });\n\tif (path.endsWith(\".sys.mjs\")) path = path.replace(/\\.sys\\.mjs$/, \".jsm\");\n\treturn ChromeUtils.import(path);\n}\n\n//#endregion\n//#region src/helpers/clipboard.ts\n/**\n* Copy helper for text/richtext/image.\n*\n* @example\n* Copy plain text\n* ```ts\n* new ClipboardHelper().addText(\"plain\", \"text/unicode\").copy();\n* ```\n* @example\n* Copy plain text & rich text\n* ```ts\n* new ClipboardHelper().addText(\"plain\", \"text/unicode\")\n*                     .addText(\"<h1>rich text</h1>\", \"text/html\")\n*                     .copy();\n* ```\n* @example\n* Copy plain text, rich text & image\n* ```ts\n* new ClipboardHelper().addText(\"plain\", \"text/unicode\")\n*                     .addText(\"<h1>rich text</h1>\", \"text/html\")\n*                     .addImage(\"data:image/png;base64,...\")\n*                     .copy();\n* ```\n*/\nvar ClipboardHelper = class extends BasicTool {\n\ttransferable;\n\tclipboardService;\n\tfilePath = \"\";\n\tconstructor() {\n\t\tsuper();\n\t\tthis.transferable = Components.classes[\"@mozilla.org/widget/transferable;1\"].createInstance(Components.interfaces.nsITransferable);\n\t\tthis.clipboardService = Components.classes[\"@mozilla.org/widget/clipboard;1\"].getService(Components.interfaces.nsIClipboard);\n\t\tthis.transferable.init(null);\n\t}\n\taddText(source, type = \"text/plain\") {\n\t\tconst str = Components.classes[\"@mozilla.org/supports-string;1\"].createInstance(Components.interfaces.nsISupportsString);\n\t\tstr.data = source;\n\t\tif (type === \"text/unicode\") type = \"text/plain\";\n\t\tthis.transferable.addDataFlavor(type);\n\t\tthis.transferable.setTransferData(type, str, source.length * 2);\n\t\treturn this;\n\t}\n\taddImage(source) {\n\t\tconst parts = source.split(\",\");\n\t\tif (!parts[0].includes(\"base64\")) return this;\n\t\tconst mime = parts[0].match(/:(.*?);/)[1];\n\t\tconst bstr = this.getGlobal(\"window\").atob(parts[1]);\n\t\tlet n = bstr.length;\n\t\tconst u8arr = new Uint8Array(n);\n\t\twhile (n--) u8arr[n] = bstr.charCodeAt(n);\n\t\tconst imgTools = Components.classes[\"@mozilla.org/image/tools;1\"].getService(Components.interfaces.imgITools);\n\t\tlet mimeType;\n\t\tlet img;\n\t\tif (this.getGlobal(\"Zotero\").platformMajorVersion >= 102) {\n\t\t\timg = imgTools.decodeImageFromArrayBuffer(u8arr.buffer, mime);\n\t\t\tmimeType = \"application/x-moz-nativeimage\";\n\t\t} else {\n\t\t\tmimeType = `image/png`;\n\t\t\timg = Components.classes[\"@mozilla.org/supports-interface-pointer;1\"].createInstance(Components.interfaces.nsISupportsInterfacePointer);\n\t\t\timg.data = imgTools.decodeImageFromArrayBuffer(u8arr.buffer, mimeType);\n\t\t}\n\t\tthis.transferable.addDataFlavor(mimeType);\n\t\tthis.transferable.setTransferData(mimeType, img, 0);\n\t\treturn this;\n\t}\n\taddFile(path) {\n\t\tconst file = Components.classes[\"@mozilla.org/file/local;1\"].createInstance(Components.interfaces.nsIFile);\n\t\tfile.initWithPath(path);\n\t\tthis.transferable.addDataFlavor(\"application/x-moz-file\");\n\t\tthis.transferable.setTransferData(\"application/x-moz-file\", file);\n\t\tthis.filePath = path;\n\t\treturn this;\n\t}\n\tcopy() {\n\t\ttry {\n\t\t\tthis.clipboardService.setData(this.transferable, null, Components.interfaces.nsIClipboard.kGlobalClipboard);\n\t\t} catch (e) {\n\t\t\tif (this.filePath && Zotero.isMac) Zotero.Utilities.Internal.exec(`/usr/bin/osascript`, [`-e`, `set the clipboard to POSIX file \"${this.filePath}\"`]);\n\t\t\telse throw e;\n\t\t}\n\t\treturn this;\n\t}\n};\n\n//#endregion\n//#region src/tools/ui.ts\n/**\n* UI APIs. Create elements and manage them.\n*/\nvar UITool = class extends BasicTool {\n\tget basicOptions() {\n\t\treturn this._basicOptions;\n\t}\n\t/**\n\t* Store elements created with this instance\n\t*\n\t* @remarks\n\t* > What is this for?\n\t*\n\t* In bootstrap plugins, elements must be manually maintained and removed on exiting.\n\t*\n\t* This API does this for you.\n\t*/\n\telementCache;\n\tconstructor(base) {\n\t\tsuper(base);\n\t\tthis.elementCache = [];\n\t\tif (!this._basicOptions.ui) this._basicOptions.ui = {\n\t\t\tenableElementRecord: true,\n\t\t\tenableElementJSONLog: false,\n\t\t\tenableElementDOMLog: true\n\t\t};\n\t}\n\t/**\n\t* Remove all elements created by `createElement`.\n\t*\n\t* @remarks\n\t* > What is this for?\n\t*\n\t* In bootstrap plugins, elements must be manually maintained and removed on exiting.\n\t*\n\t* This API does this for you.\n\t*/\n\tunregisterAll() {\n\t\tthis.elementCache.forEach((e) => {\n\t\t\ttry {\n\t\t\t\te?.deref()?.remove();\n\t\t\t} catch (e$1) {\n\t\t\t\tthis.log(e$1);\n\t\t\t}\n\t\t});\n\t}\n\tcreateElement(...args) {\n\t\tconst doc = args[0];\n\t\tconst tagName = args[1].toLowerCase();\n\t\tlet props = args[2] || {};\n\t\tif (!tagName) return;\n\t\tif (typeof args[2] === \"string\") props = {\n\t\t\tnamespace: args[2],\n\t\t\tenableElementRecord: args[3]\n\t\t};\n\t\tif (typeof props.enableElementJSONLog !== \"undefined\" && props.enableElementJSONLog || this.basicOptions.ui.enableElementJSONLog) this.log(props);\n\t\tprops.properties = props.properties || props.directAttributes;\n\t\tprops.children = props.children || props.subElementOptions;\n\t\tlet elem;\n\t\tif (tagName === \"fragment\") {\n\t\t\tconst fragElem = doc.createDocumentFragment();\n\t\t\telem = fragElem;\n\t\t} else {\n\t\t\tlet realElem = props.id && (props.checkExistenceParent ? props.checkExistenceParent : doc).querySelector(`#${props.id}`);\n\t\t\tif (realElem && props.ignoreIfExists) return realElem;\n\t\t\tif (realElem && props.removeIfExists) {\n\t\t\t\trealElem.remove();\n\t\t\t\trealElem = void 0;\n\t\t\t}\n\t\t\tif (props.customCheck && !props.customCheck(doc, props)) return void 0;\n\t\t\tif (!realElem || !props.skipIfExists) {\n\t\t\t\tlet namespace = props.namespace;\n\t\t\t\tif (!namespace) {\n\t\t\t\t\tconst mightHTML = HTMLElementTagNames.includes(tagName);\n\t\t\t\t\tconst mightXUL = XULElementTagNames.includes(tagName);\n\t\t\t\t\tconst mightSVG = SVGElementTagNames.includes(tagName);\n\t\t\t\t\tif (Number(mightHTML) + Number(mightXUL) + Number(mightSVG) > 1) this.log(`[Warning] Creating element ${tagName} with no namespace specified. Found multiply namespace matches.`);\n\t\t\t\t\tif (mightHTML) namespace = \"html\";\n\t\t\t\t\telse if (mightXUL) namespace = \"xul\";\n\t\t\t\t\telse if (mightSVG) namespace = \"svg\";\n\t\t\t\t\telse namespace = \"html\";\n\t\t\t\t}\n\t\t\t\tif (namespace === \"xul\") realElem = this.createXULElement(doc, tagName);\n\t\t\t\telse realElem = doc.createElementNS({\n\t\t\t\t\thtml: \"http://www.w3.org/1999/xhtml\",\n\t\t\t\t\tsvg: \"http://www.w3.org/2000/svg\"\n\t\t\t\t}[namespace], tagName);\n\t\t\t\tif (typeof props.enableElementRecord !== \"undefined\" ? props.enableElementRecord : this.basicOptions.ui.enableElementRecord) this.elementCache.push(new WeakRef(realElem));\n\t\t\t}\n\t\t\tif (props.id) realElem.id = props.id;\n\t\t\tif (props.styles && Object.keys(props.styles).length) Object.keys(props.styles).forEach((k) => {\n\t\t\t\tconst v = props.styles[k];\n\t\t\t\ttypeof v !== \"undefined\" && (realElem.style[k] = v);\n\t\t\t});\n\t\t\tif (props.properties && Object.keys(props.properties).length) Object.keys(props.properties).forEach((k) => {\n\t\t\t\tconst v = props.properties[k];\n\t\t\t\ttypeof v !== \"undefined\" && (realElem[k] = v);\n\t\t\t});\n\t\t\tif (props.attributes && Object.keys(props.attributes).length) Object.keys(props.attributes).forEach((k) => {\n\t\t\t\tconst v = props.attributes[k];\n\t\t\t\ttypeof v !== \"undefined\" && realElem.setAttribute(k, String(v));\n\t\t\t});\n\t\t\tif (props.classList?.length) realElem.classList.add(...props.classList);\n\t\t\tif (props.listeners?.length) props.listeners.forEach(({ type, listener, options }) => {\n\t\t\t\tlistener && realElem.addEventListener(type, listener, options);\n\t\t\t});\n\t\t\telem = realElem;\n\t\t}\n\t\tif (props.children?.length) {\n\t\t\tconst subElements = props.children.map((childProps) => {\n\t\t\t\tchildProps.namespace = childProps.namespace || props.namespace;\n\t\t\t\treturn this.createElement(doc, childProps.tag, childProps);\n\t\t\t}).filter((e) => e);\n\t\t\telem.append(...subElements);\n\t\t}\n\t\tif (typeof props.enableElementDOMLog !== \"undefined\" ? props.enableElementDOMLog : this.basicOptions.ui.enableElementDOMLog) this.log(elem);\n\t\treturn elem;\n\t}\n\t/**\n\t* Append element(s) to a node.\n\t* @param properties See {@link ElementProps}\n\t* @param container The parent node to append to.\n\t* @returns A Node that is the appended child (aChild),\n\t*          except when aChild is a DocumentFragment,\n\t*          in which case the empty DocumentFragment is returned.\n\t*/\n\tappendElement(properties, container) {\n\t\treturn container.appendChild(this.createElement(container.ownerDocument, properties.tag, properties));\n\t}\n\t/**\n\t* Inserts a node before a reference node as a child of its parent node.\n\t* @param properties See {@link ElementProps}\n\t* @param referenceNode The node before which newNode is inserted.\n\t* @returns Node\n\t*/\n\tinsertElementBefore(properties, referenceNode) {\n\t\tif (referenceNode.parentNode) return referenceNode.parentNode.insertBefore(this.createElement(referenceNode.ownerDocument, properties.tag, properties), referenceNode);\n\t\telse this.log(`${referenceNode.tagName} has no parent, cannot insert ${properties.tag}`);\n\t}\n\t/**\n\t* Replace oldNode with a new one.\n\t* @param properties See {@link ElementProps}\n\t* @param oldNode The child to be replaced.\n\t* @returns The replaced Node. This is the same node as oldChild.\n\t*/\n\treplaceElement(properties, oldNode) {\n\t\tif (oldNode.parentNode) return oldNode.parentNode.replaceChild(this.createElement(oldNode.ownerDocument, properties.tag, properties), oldNode);\n\t\telse this.log(`${oldNode.tagName} has no parent, cannot replace it with ${properties.tag}`);\n\t}\n\t/**\n\t* Parse XHTML to XUL fragment. For Zotero 6.\n\t*\n\t* To load preferences from a Zotero 7's `.xhtml`, use this method to parse it.\n\t* @param str xhtml raw text\n\t* @param entities dtd file list (\"chrome://xxx.dtd\")\n\t* @param defaultXUL true for default XUL namespace\n\t*/\n\tparseXHTMLToFragment(str, entities = [], defaultXUL = true) {\n\t\tconst parser = new DOMParser();\n\t\tconst xulns = \"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\";\n\t\tconst htmlns = \"http://www.w3.org/1999/xhtml\";\n\t\tconst wrappedStr = `${entities.length ? `<!DOCTYPE bindings [ ${entities.reduce((preamble, url, index) => {\n\t\t\treturn `${preamble}<!ENTITY % _dtd-${index} SYSTEM \"${url}\"> %_dtd-${index}; `;\n\t\t}, \"\")}]>` : \"\"}\n      <html:div xmlns=\"${defaultXUL ? xulns : htmlns}\"\n          xmlns:xul=\"${xulns}\" xmlns:html=\"${htmlns}\">\n      ${str}\n      </html:div>`;\n\t\tthis.log(wrappedStr, parser);\n\t\tconst doc = parser.parseFromString(wrappedStr, \"text/xml\");\n\t\tthis.log(doc);\n\t\tif (doc.documentElement.localName === \"parsererror\") throw new Error(\"not well-formed XHTML\");\n\t\tconst range = doc.createRange();\n\t\trange.selectNodeContents(doc.querySelector(\"div\"));\n\t\treturn range.extractContents();\n\t}\n};\nconst HTMLElementTagNames = [\n\t\"a\",\n\t\"abbr\",\n\t\"address\",\n\t\"area\",\n\t\"article\",\n\t\"aside\",\n\t\"audio\",\n\t\"b\",\n\t\"base\",\n\t\"bdi\",\n\t\"bdo\",\n\t\"blockquote\",\n\t\"body\",\n\t\"br\",\n\t\"button\",\n\t\"canvas\",\n\t\"caption\",\n\t\"cite\",\n\t\"code\",\n\t\"col\",\n\t\"colgroup\",\n\t\"data\",\n\t\"datalist\",\n\t\"dd\",\n\t\"del\",\n\t\"details\",\n\t\"dfn\",\n\t\"dialog\",\n\t\"div\",\n\t\"dl\",\n\t\"dt\",\n\t\"em\",\n\t\"embed\",\n\t\"fieldset\",\n\t\"figcaption\",\n\t\"figure\",\n\t\"footer\",\n\t\"form\",\n\t\"h1\",\n\t\"h2\",\n\t\"h3\",\n\t\"h4\",\n\t\"h5\",\n\t\"h6\",\n\t\"head\",\n\t\"header\",\n\t\"hgroup\",\n\t\"hr\",\n\t\"html\",\n\t\"i\",\n\t\"iframe\",\n\t\"img\",\n\t\"input\",\n\t\"ins\",\n\t\"kbd\",\n\t\"label\",\n\t\"legend\",\n\t\"li\",\n\t\"link\",\n\t\"main\",\n\t\"map\",\n\t\"mark\",\n\t\"menu\",\n\t\"meta\",\n\t\"meter\",\n\t\"nav\",\n\t\"noscript\",\n\t\"object\",\n\t\"ol\",\n\t\"optgroup\",\n\t\"option\",\n\t\"output\",\n\t\"p\",\n\t\"picture\",\n\t\"pre\",\n\t\"progress\",\n\t\"q\",\n\t\"rp\",\n\t\"rt\",\n\t\"ruby\",\n\t\"s\",\n\t\"samp\",\n\t\"script\",\n\t\"section\",\n\t\"select\",\n\t\"slot\",\n\t\"small\",\n\t\"source\",\n\t\"span\",\n\t\"strong\",\n\t\"style\",\n\t\"sub\",\n\t\"summary\",\n\t\"sup\",\n\t\"table\",\n\t\"tbody\",\n\t\"td\",\n\t\"template\",\n\t\"textarea\",\n\t\"tfoot\",\n\t\"th\",\n\t\"thead\",\n\t\"time\",\n\t\"title\",\n\t\"tr\",\n\t\"track\",\n\t\"u\",\n\t\"ul\",\n\t\"var\",\n\t\"video\",\n\t\"wbr\"\n];\nconst XULElementTagNames = [\n\t\"action\",\n\t\"arrowscrollbox\",\n\t\"bbox\",\n\t\"binding\",\n\t\"bindings\",\n\t\"box\",\n\t\"broadcaster\",\n\t\"broadcasterset\",\n\t\"button\",\n\t\"browser\",\n\t\"checkbox\",\n\t\"caption\",\n\t\"colorpicker\",\n\t\"column\",\n\t\"columns\",\n\t\"commandset\",\n\t\"command\",\n\t\"conditions\",\n\t\"content\",\n\t\"deck\",\n\t\"description\",\n\t\"dialog\",\n\t\"dialogheader\",\n\t\"editor\",\n\t\"grid\",\n\t\"grippy\",\n\t\"groupbox\",\n\t\"hbox\",\n\t\"iframe\",\n\t\"image\",\n\t\"key\",\n\t\"keyset\",\n\t\"label\",\n\t\"listbox\",\n\t\"listcell\",\n\t\"listcol\",\n\t\"listcols\",\n\t\"listhead\",\n\t\"listheader\",\n\t\"listitem\",\n\t\"member\",\n\t\"menu\",\n\t\"menubar\",\n\t\"menuitem\",\n\t\"menulist\",\n\t\"menupopup\",\n\t\"menuseparator\",\n\t\"observes\",\n\t\"overlay\",\n\t\"page\",\n\t\"popup\",\n\t\"popupset\",\n\t\"preference\",\n\t\"preferences\",\n\t\"prefpane\",\n\t\"prefwindow\",\n\t\"progressmeter\",\n\t\"radio\",\n\t\"radiogroup\",\n\t\"resizer\",\n\t\"richlistbox\",\n\t\"richlistitem\",\n\t\"row\",\n\t\"rows\",\n\t\"rule\",\n\t\"script\",\n\t\"scrollbar\",\n\t\"scrollbox\",\n\t\"scrollcorner\",\n\t\"separator\",\n\t\"spacer\",\n\t\"splitter\",\n\t\"stack\",\n\t\"statusbar\",\n\t\"statusbarpanel\",\n\t\"stringbundle\",\n\t\"stringbundleset\",\n\t\"tab\",\n\t\"tabbrowser\",\n\t\"tabbox\",\n\t\"tabpanel\",\n\t\"tabpanels\",\n\t\"tabs\",\n\t\"template\",\n\t\"textnode\",\n\t\"textbox\",\n\t\"titlebar\",\n\t\"toolbar\",\n\t\"toolbarbutton\",\n\t\"toolbargrippy\",\n\t\"toolbaritem\",\n\t\"toolbarpalette\",\n\t\"toolbarseparator\",\n\t\"toolbarset\",\n\t\"toolbarspacer\",\n\t\"toolbarspring\",\n\t\"toolbox\",\n\t\"tooltip\",\n\t\"tree\",\n\t\"treecell\",\n\t\"treechildren\",\n\t\"treecol\",\n\t\"treecols\",\n\t\"treeitem\",\n\t\"treerow\",\n\t\"treeseparator\",\n\t\"triple\",\n\t\"vbox\",\n\t\"window\",\n\t\"wizard\",\n\t\"wizardpage\"\n];\nconst SVGElementTagNames = [\n\t\"a\",\n\t\"animate\",\n\t\"animateMotion\",\n\t\"animateTransform\",\n\t\"circle\",\n\t\"clipPath\",\n\t\"defs\",\n\t\"desc\",\n\t\"ellipse\",\n\t\"feBlend\",\n\t\"feColorMatrix\",\n\t\"feComponentTransfer\",\n\t\"feComposite\",\n\t\"feConvolveMatrix\",\n\t\"feDiffuseLighting\",\n\t\"feDisplacementMap\",\n\t\"feDistantLight\",\n\t\"feDropShadow\",\n\t\"feFlood\",\n\t\"feFuncA\",\n\t\"feFuncB\",\n\t\"feFuncG\",\n\t\"feFuncR\",\n\t\"feGaussianBlur\",\n\t\"feImage\",\n\t\"feMerge\",\n\t\"feMergeNode\",\n\t\"feMorphology\",\n\t\"feOffset\",\n\t\"fePointLight\",\n\t\"feSpecularLighting\",\n\t\"feSpotLight\",\n\t\"feTile\",\n\t\"feTurbulence\",\n\t\"filter\",\n\t\"foreignObject\",\n\t\"g\",\n\t\"image\",\n\t\"line\",\n\t\"linearGradient\",\n\t\"marker\",\n\t\"mask\",\n\t\"metadata\",\n\t\"mpath\",\n\t\"path\",\n\t\"pattern\",\n\t\"polygon\",\n\t\"polyline\",\n\t\"radialGradient\",\n\t\"rect\",\n\t\"script\",\n\t\"set\",\n\t\"stop\",\n\t\"style\",\n\t\"svg\",\n\t\"switch\",\n\t\"symbol\",\n\t\"text\",\n\t\"textPath\",\n\t\"title\",\n\t\"tspan\",\n\t\"use\",\n\t\"view\"\n];\n\n//#endregion\n//#region src/helpers/dialog.ts\n/**\n* Dialog window helper. A superset of XUL dialog.\n*/\nvar DialogHelper = class extends UITool {\n\t/**\n\t* Passed to dialog window for data-binding and lifecycle controls. See {@link DialogHelper.setDialogData}\n\t*/\n\tdialogData;\n\t/**\n\t* Dialog window instance\n\t*/\n\twindow;\n\telementProps;\n\t/**\n\t* Create a dialog helper with row \\* column grids.\n\t* @param row\n\t* @param column\n\t*/\n\tconstructor(row, column) {\n\t\tsuper();\n\t\tif (row <= 0 || column <= 0) throw new Error(`row and column must be positive integers.`);\n\t\tthis.elementProps = {\n\t\t\ttag: \"vbox\",\n\t\t\tattributes: { flex: 1 },\n\t\t\tstyles: {\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\"\n\t\t\t},\n\t\t\tchildren: []\n\t\t};\n\t\tfor (let i = 0; i < Math.max(row, 1); i++) {\n\t\t\tthis.elementProps.children.push({\n\t\t\t\ttag: \"hbox\",\n\t\t\t\tattributes: { flex: 1 },\n\t\t\t\tchildren: []\n\t\t\t});\n\t\t\tfor (let j = 0; j < Math.max(column, 1); j++) this.elementProps.children[i].children.push({\n\t\t\t\ttag: \"vbox\",\n\t\t\t\tattributes: { flex: 1 },\n\t\t\t\tchildren: []\n\t\t\t});\n\t\t}\n\t\tthis.elementProps.children.push({\n\t\t\ttag: \"hbox\",\n\t\t\tattributes: {\n\t\t\t\tflex: 0,\n\t\t\t\tpack: \"end\"\n\t\t\t},\n\t\t\tchildren: []\n\t\t});\n\t\tthis.dialogData = {};\n\t}\n\t/**\n\t* Add a cell at (row, column). Index starts from 0.\n\t* @param row\n\t* @param column\n\t* @param elementProps Cell element props. See {@link ElementProps}\n\t* @param cellFlex If the cell is flex. Default true.\n\t*/\n\taddCell(row, column, elementProps, cellFlex = true) {\n\t\tif (row >= this.elementProps.children.length || column >= this.elementProps.children[row].children.length) throw new Error(`Cell index (${row}, ${column}) is invalid, maximum (${this.elementProps.children.length}, ${this.elementProps.children[0].children.length})`);\n\t\tthis.elementProps.children[row].children[column].children = [elementProps];\n\t\tthis.elementProps.children[row].children[column].attributes.flex = cellFlex ? 1 : 0;\n\t\treturn this;\n\t}\n\t/**\n\t* Add a control button to the bottom of the dialog.\n\t* @param label Button label\n\t* @param id Button id.\n\t* The corresponding id of the last button user clicks before window exit will be set to `dialogData._lastButtonId`.\n\t* @param options Options\n\t* @param [options.noClose] Don't close window when clicking this button.\n\t* @param [options.callback] Callback of button click event.\n\t*/\n\taddButton(label, id, options = {}) {\n\t\tid = id || `btn-${Zotero.Utilities.randomString()}-${(/* @__PURE__ */ new Date()).getTime()}`;\n\t\tthis.elementProps.children[this.elementProps.children.length - 1].children.push({\n\t\t\ttag: \"vbox\",\n\t\t\tstyles: { margin: \"10px\" },\n\t\t\tchildren: [{\n\t\t\t\ttag: \"button\",\n\t\t\t\tnamespace: \"html\",\n\t\t\t\tid,\n\t\t\t\tattributes: {\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\t\"data-l10n-id\": label\n\t\t\t\t},\n\t\t\t\tproperties: { innerHTML: label },\n\t\t\t\tlisteners: [{\n\t\t\t\t\ttype: \"click\",\n\t\t\t\t\tlistener: (e) => {\n\t\t\t\t\t\tthis.dialogData._lastButtonId = id;\n\t\t\t\t\t\tif (options.callback) options.callback(e);\n\t\t\t\t\t\tif (!options.noClose) this.window.close();\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t});\n\t\treturn this;\n\t}\n\t/**\n\t* Dialog data.\n\t* @remarks\n\t* This object is passed to the dialog window.\n\t*\n\t* The control button id is in `dialogData._lastButtonId`;\n\t*\n\t* The data-binding values are in `dialogData`.\n\t* ```ts\n\t* interface DialogData {\n\t*   [key: string | number | symbol]: any;\n\t*   loadLock?: { promise: Promise<void>; resolve: () => void; isResolved: () => boolean }; // resolve after window load (auto-generated)\n\t*   loadCallback?: Function; // called after window load\n\t*   unloadLock?: { promise: Promise<void>; resolve: () => void }; // resolve after window unload (auto-generated)\n\t*   unloadCallback?: Function; // called after window unload\n\t*   beforeUnloadCallback?: Function; // called before window unload when elements are accessable.\n\t* }\n\t* ```\n\t* @param dialogData\n\t*/\n\tsetDialogData(dialogData) {\n\t\tthis.dialogData = dialogData;\n\t\treturn this;\n\t}\n\t/**\n\t* Open the dialog\n\t* @param title Window title\n\t* @param windowFeatures\n\t* @param windowFeatures.width Ignored if fitContent is `true`.\n\t* @param windowFeatures.height Ignored if fitContent is `true`.\n\t* @param windowFeatures.left\n\t* @param windowFeatures.top\n\t* @param windowFeatures.centerscreen Open window at the center of screen.\n\t* @param windowFeatures.resizable If window is resizable.\n\t* @param windowFeatures.fitContent Resize the window to content size after elements are loaded.\n\t* @param windowFeatures.noDialogMode Dialog mode window only has a close button. Set `true` to make maximize and minimize button visible.\n\t* @param windowFeatures.alwaysRaised Is the window always at the top.\n\t*/\n\topen(title, windowFeatures = {\n\t\tcenterscreen: true,\n\t\tresizable: true,\n\t\tfitContent: true\n\t}) {\n\t\tthis.window = openDialog(this, `dialog-${Zotero.Utilities.randomString()}-${(/* @__PURE__ */ new Date()).getTime()}`, title, this.elementProps, this.dialogData, windowFeatures);\n\t\treturn this;\n\t}\n};\nfunction openDialog(dialogHelper, targetId, title, elementProps, dialogData, windowFeatures = {\n\tcenterscreen: true,\n\tresizable: true,\n\tfitContent: true\n}) {\n\tdialogData = dialogData || {};\n\tif (!dialogData.loadLock) {\n\t\tlet loadResolve;\n\t\tlet isLoadResolved = false;\n\t\tconst loadPromise = new Promise((resolve) => {\n\t\t\tloadResolve = resolve;\n\t\t});\n\t\tloadPromise.then(() => {\n\t\t\tisLoadResolved = true;\n\t\t});\n\t\tdialogData.loadLock = {\n\t\t\tpromise: loadPromise,\n\t\t\tresolve: loadResolve,\n\t\t\tisResolved: () => isLoadResolved\n\t\t};\n\t}\n\tif (!dialogData.unloadLock) {\n\t\tlet unloadResolve;\n\t\tconst unloadPromise = new Promise((resolve) => {\n\t\t\tunloadResolve = resolve;\n\t\t});\n\t\tdialogData.unloadLock = {\n\t\t\tpromise: unloadPromise,\n\t\t\tresolve: unloadResolve\n\t\t};\n\t}\n\tlet featureString = `resizable=${windowFeatures.resizable ? \"yes\" : \"no\"},`;\n\tif (windowFeatures.width || windowFeatures.height) featureString += `width=${windowFeatures.width || 100},height=${windowFeatures.height || 100},`;\n\tif (windowFeatures.left) featureString += `left=${windowFeatures.left},`;\n\tif (windowFeatures.top) featureString += `top=${windowFeatures.top},`;\n\tif (windowFeatures.centerscreen) featureString += \"centerscreen,\";\n\tif (windowFeatures.noDialogMode) featureString += \"dialog=no,\";\n\tif (windowFeatures.alwaysRaised) featureString += \"alwaysRaised=yes,\";\n\tconst win = dialogHelper.getGlobal(\"openDialog\")(\"about:blank\", targetId || \"_blank\", featureString, dialogData);\n\tdialogData.loadLock?.promise.then(() => {\n\t\twin.document.head.appendChild(dialogHelper.createElement(win.document, \"title\", {\n\t\t\tproperties: { innerText: title },\n\t\t\tattributes: { \"data-l10n-id\": title }\n\t\t}));\n\t\tlet l10nFiles = dialogData.l10nFiles || [];\n\t\tif (typeof l10nFiles === \"string\") l10nFiles = [l10nFiles];\n\t\tl10nFiles.forEach((file) => {\n\t\t\twin.document.head.appendChild(dialogHelper.createElement(win.document, \"link\", { properties: {\n\t\t\t\trel: \"localization\",\n\t\t\t\thref: file\n\t\t\t} }));\n\t\t});\n\t\tdialogHelper.appendElement({\n\t\t\ttag: \"fragment\",\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttag: \"style\",\n\t\t\t\t\tproperties: { innerHTML: style }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttag: \"link\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\trel: \"stylesheet\",\n\t\t\t\t\t\thref: \"chrome://global/skin/global.css\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttag: \"link\",\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\trel: \"stylesheet\",\n\t\t\t\t\t\thref: \"chrome://zotero-platform/content/zotero.css\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}, win.document.head);\n\t\treplaceElement(elementProps, dialogHelper);\n\t\twin.document.body.appendChild(dialogHelper.createElement(win.document, \"fragment\", { children: [elementProps] }));\n\t\tArray.from(win.document.querySelectorAll(\"*[data-bind]\")).forEach((elem) => {\n\t\t\tconst bindKey = elem.getAttribute(\"data-bind\");\n\t\t\tconst bindAttr = elem.getAttribute(\"data-attr\");\n\t\t\tconst bindProp = elem.getAttribute(\"data-prop\");\n\t\t\tif (bindKey && dialogData && dialogData[bindKey]) if (bindProp) elem[bindProp] = dialogData[bindKey];\n\t\t\telse elem.setAttribute(bindAttr || \"value\", dialogData[bindKey]);\n\t\t});\n\t\tif (windowFeatures.fitContent) setTimeout(() => {\n\t\t\twin.sizeToContent();\n\t\t}, 300);\n\t\twin.focus();\n\t}).then(() => {\n\t\tdialogData?.loadCallback && dialogData.loadCallback();\n\t});\n\tdialogData.unloadLock?.promise.then(() => {\n\t\tdialogData?.unloadCallback && dialogData.unloadCallback();\n\t});\n\twin.addEventListener(\"DOMContentLoaded\", function onWindowLoad(_ev) {\n\t\twin.arguments[0]?.loadLock?.resolve();\n\t\twin.removeEventListener(\"DOMContentLoaded\", onWindowLoad, false);\n\t}, false);\n\twin.addEventListener(\"beforeunload\", function onWindowBeforeUnload(_ev) {\n\t\tArray.from(win.document.querySelectorAll(\"*[data-bind]\")).forEach((elem) => {\n\t\t\tconst dialogData$1 = this.window.arguments[0];\n\t\t\tconst bindKey = elem.getAttribute(\"data-bind\");\n\t\t\tconst bindAttr = elem.getAttribute(\"data-attr\");\n\t\t\tconst bindProp = elem.getAttribute(\"data-prop\");\n\t\t\tif (bindKey && dialogData$1) if (bindProp) dialogData$1[bindKey] = elem[bindProp];\n\t\t\telse dialogData$1[bindKey] = elem.getAttribute(bindAttr || \"value\");\n\t\t});\n\t\tthis.window.removeEventListener(\"beforeunload\", onWindowBeforeUnload, false);\n\t\tdialogData?.beforeUnloadCallback && dialogData.beforeUnloadCallback();\n\t});\n\twin.addEventListener(\"unload\", function onWindowUnload(_ev) {\n\t\tif (!this.window.arguments[0]?.loadLock?.isResolved()) return;\n\t\tthis.window.arguments[0]?.unloadLock?.resolve();\n\t\tthis.window.removeEventListener(\"unload\", onWindowUnload, false);\n\t});\n\tif (win.document.readyState === \"complete\") win.arguments[0]?.loadLock?.resolve();\n\treturn win;\n}\nfunction replaceElement(elementProps, uiTool) {\n\tlet checkChildren = true;\n\tif (elementProps.tag === \"select\") {\n\t\tlet is140 = false;\n\t\ttry {\n\t\t\tis140 = Number.parseInt(Services.appinfo.platformVersion.match(/^\\d+/)[0]) >= 140;\n\t\t} catch {\n\t\t\tis140 = false;\n\t\t}\n\t\tif (!is140) {\n\t\t\tcheckChildren = false;\n\t\t\tconst customSelectProps = {\n\t\t\t\ttag: \"div\",\n\t\t\t\tclassList: [\"dropdown\"],\n\t\t\t\tlisteners: [{\n\t\t\t\t\ttype: \"mouseleave\",\n\t\t\t\t\tlistener: (ev) => {\n\t\t\t\t\t\tconst select = ev.target.querySelector(\"select\");\n\t\t\t\t\t\tselect?.blur();\n\t\t\t\t\t}\n\t\t\t\t}],\n\t\t\t\tchildren: [Object.assign({}, elementProps, {\n\t\t\t\t\ttag: \"select\",\n\t\t\t\t\tlisteners: [{\n\t\t\t\t\t\ttype: \"focus\",\n\t\t\t\t\t\tlistener: (ev) => {\n\t\t\t\t\t\t\tconst select = ev.target;\n\t\t\t\t\t\t\tconst dropdown = select.parentElement?.querySelector(\".dropdown-content\");\n\t\t\t\t\t\t\tdropdown && (dropdown.style.display = \"block\");\n\t\t\t\t\t\t\tselect.setAttribute(\"focus\", \"true\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: \"blur\",\n\t\t\t\t\t\tlistener: (ev) => {\n\t\t\t\t\t\t\tconst select = ev.target;\n\t\t\t\t\t\t\tconst dropdown = select.parentElement?.querySelector(\".dropdown-content\");\n\t\t\t\t\t\t\tdropdown && (dropdown.style.display = \"none\");\n\t\t\t\t\t\t\tselect.removeAttribute(\"focus\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t}), {\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"dropdown-content\"],\n\t\t\t\t\tchildren: elementProps.children?.map((option) => ({\n\t\t\t\t\t\ttag: \"p\",\n\t\t\t\t\t\tattributes: { value: option.properties?.value },\n\t\t\t\t\t\tproperties: { innerHTML: option.properties?.innerHTML || option.properties?.textContent },\n\t\t\t\t\t\tclassList: [\"dropdown-item\"],\n\t\t\t\t\t\tlisteners: [{\n\t\t\t\t\t\t\ttype: \"click\",\n\t\t\t\t\t\t\tlistener: (ev) => {\n\t\t\t\t\t\t\t\tconst select = ev.target.parentElement?.previousElementSibling;\n\t\t\t\t\t\t\t\tselect && (select.value = ev.target.getAttribute(\"value\") || \"\");\n\t\t\t\t\t\t\t\tselect?.blur();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}))\n\t\t\t\t}]\n\t\t\t};\n\t\t\tfor (const key in elementProps) delete elementProps[key];\n\t\t\tObject.assign(elementProps, customSelectProps);\n\t\t} else {\n\t\t\tconst children = elementProps.children || [];\n\t\t\tconst randomString = CSS.escape(`${Zotero.Utilities.randomString()}-${(/* @__PURE__ */ new Date()).getTime()}`);\n\t\t\tif (!elementProps.id) elementProps.id = `select-${randomString}`;\n\t\t\tconst selectId = elementProps.id;\n\t\t\tconst popupId = `popup-${randomString}`;\n\t\t\tconst popup = uiTool.appendElement({\n\t\t\t\ttag: \"menupopup\",\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tid: popupId,\n\t\t\t\tchildren: children.map((option) => ({\n\t\t\t\t\ttag: \"menuitem\",\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tvalue: option.properties?.value,\n\t\t\t\t\t\tlabel: option.properties?.innerHTML || option.properties?.textContent\n\t\t\t\t\t}\n\t\t\t\t})),\n\t\t\t\tlisteners: [{\n\t\t\t\t\ttype: \"command\",\n\t\t\t\t\tlistener: (ev) => {\n\t\t\t\t\t\tif (ev.target?.tagName !== \"menuitem\") return;\n\t\t\t\t\t\tconst select = uiTool.window.document.getElementById(selectId);\n\t\t\t\t\t\tconst menuitem = ev.target;\n\t\t\t\t\t\tif (select) {\n\t\t\t\t\t\t\tselect.value = menuitem.getAttribute(\"value\") || \"\";\n\t\t\t\t\t\t\tselect.blur();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpopup.hidePopup();\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}, uiTool.window.document.body);\n\t\t\tif (!elementProps.listeners) elementProps.listeners = [];\n\t\t\telementProps.listeners.push(...[{\n\t\t\t\ttype: \"click\",\n\t\t\t\tlistener: (ev) => {\n\t\t\t\t\tconst select = ev.target;\n\t\t\t\t\tconst rect = select.getBoundingClientRect();\n\t\t\t\t\tlet left = rect.left + uiTool.window.scrollX;\n\t\t\t\t\tlet top = rect.bottom + uiTool.window.scrollY;\n\t\t\t\t\tif (uiTool.getGlobal(\"Zotero\").isMac) {\n\t\t\t\t\t\tleft += uiTool.window.screenLeft;\n\t\t\t\t\t\ttop += uiTool.window.screenTop + rect.height;\n\t\t\t\t\t}\n\t\t\t\t\tfixMenuPopup(popup, uiTool);\n\t\t\t\t\tpopup.openPopup(null, \"\", left, top, false, false);\n\t\t\t\t\tselect.setAttribute(\"focus\", \"true\");\n\t\t\t\t}\n\t\t\t}]);\n\t\t}\n\t} else if (elementProps.tag === \"a\") {\n\t\tconst href = elementProps?.properties?.href || \"\";\n\t\telementProps.properties ??= {};\n\t\telementProps.properties.href = \"javascript:void(0);\";\n\t\telementProps.attributes ??= {};\n\t\telementProps.attributes[\"zotero-href\"] = href;\n\t\telementProps.listeners ??= [];\n\t\telementProps.listeners.push({\n\t\t\ttype: \"click\",\n\t\t\tlistener: (ev) => {\n\t\t\t\tconst href$1 = ev.target?.getAttribute(\"zotero-href\");\n\t\t\t\thref$1 && uiTool.getGlobal(\"Zotero\").launchURL(href$1);\n\t\t\t}\n\t\t});\n\t\telementProps.classList ??= [];\n\t\telementProps.classList.push(\"zotero-text-link\");\n\t}\n\tif (checkChildren) elementProps.children?.forEach((child) => replaceElement(child, uiTool));\n}\nconst style = `\nhtml {\n  color-scheme: light dark;\n}\n.zotero-text-link {\n  -moz-user-focus: normal;\n  color: -moz-nativehyperlinktext;\n  text-decoration: underline;\n  border: 1px solid transparent;\n  cursor: pointer;\n}\n.dropdown {\n  position: relative;\n  display: inline-block;\n}\n.dropdown-content {\n  display: none;\n  position: absolute;\n  background-color: var(--material-toolbar);\n  min-width: 160px;\n  box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.5);\n  border-radius: 5px;\n  padding: 5px 0 5px 0;\n  z-index: 999;\n}\n.dropdown-item {\n  margin: 0px;\n  padding: 5px 10px 5px 10px;\n}\n.dropdown-item:hover {\n  background-color: var(--fill-quinary);\n}\n`;\nfunction fixMenuPopup(popup, uiTool) {\n\tfor (const item of popup.querySelectorAll(\"menuitem\")) if (!item.innerHTML) uiTool.appendElement({\n\t\ttag: \"fragment\",\n\t\tchildren: [\n\t\t\t{\n\t\t\t\ttag: \"image\",\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tclassList: [\"menu-icon\"],\n\t\t\t\tattributes: { \"aria-hidden\": \"true\" }\n\t\t\t},\n\t\t\t{\n\t\t\t\ttag: \"label\",\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tclassList: [\"menu-text\"],\n\t\t\t\tproperties: { value: item.getAttribute(\"label\") || \"\" },\n\t\t\t\tattributes: {\n\t\t\t\t\tcrop: \"end\",\n\t\t\t\t\t\"aria-hidden\": \"true\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttag: \"label\",\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tclassList: [\"menu-highlightable-text\"],\n\t\t\t\tproperties: { textContent: item.getAttribute(\"label\") || \"\" },\n\t\t\t\tattributes: {\n\t\t\t\t\tcrop: \"end\",\n\t\t\t\t\t\"aria-hidden\": \"true\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttag: \"label\",\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tclassList: [\"menu-accel\"],\n\t\t\t\tattributes: { \"aria-hidden\": \"true\" }\n\t\t\t}\n\t\t]\n\t}, item);\n}\n\n//#endregion\n//#region src/helpers/filePicker.ts\n/**\n* File picker helper.\n* @param title window title\n* @param mode\n* @param filters Array<[hint string, filter string]>\n* @param suggestion default file/folder\n* @param window the parent window. By default it is the main window\n* @param filterMask built-in filters\n* @param directory directory in which to open the file picker\n* @example\n* ```ts\n* await new FilePickerHelper(\n*   `${Zotero.getString(\"fileInterface.import\")} MarkDown Document`,\n*   \"open\",\n*   [[\"MarkDown File(*.md)\", \"*.md\"]]\n* ).open();\n* ```\n*/\nvar FilePickerHelper = class extends BasicTool {\n\ttitle;\n\tmode;\n\tfilters;\n\tsuggestion;\n\tdirectory;\n\twindow;\n\tfilterMask;\n\tconstructor(title, mode, filters, suggestion, window$1, filterMask, directory) {\n\t\tsuper();\n\t\tthis.title = title;\n\t\tthis.mode = mode;\n\t\tthis.filters = filters;\n\t\tthis.suggestion = suggestion;\n\t\tthis.directory = directory;\n\t\tthis.window = window$1;\n\t\tthis.filterMask = filterMask;\n\t}\n\tasync open() {\n\t\tconst Backend = ChromeUtils.importESModule(\"chrome://zotero/content/modules/filePicker.mjs\").FilePicker;\n\t\tconst fp = new Backend();\n\t\tfp.init(this.window || this.getGlobal(\"window\"), this.title, this.getMode(fp));\n\t\tfor (const [label, ext] of this.filters || []) fp.appendFilter(label, ext);\n\t\tif (this.filterMask) fp.appendFilters(this.getFilterMask(fp));\n\t\tif (this.suggestion) fp.defaultString = this.suggestion;\n\t\tif (this.directory) fp.displayDirectory = this.directory;\n\t\tconst userChoice = await fp.show();\n\t\tswitch (userChoice) {\n\t\t\tcase fp.returnOK:\n\t\t\tcase fp.returnReplace: return this.mode === \"multiple\" ? fp.files : fp.file;\n\t\t\tdefault: return false;\n\t\t}\n\t}\n\tgetMode(fp) {\n\t\tswitch (this.mode) {\n\t\t\tcase \"open\": return fp.modeOpen;\n\t\t\tcase \"save\": return fp.modeSave;\n\t\t\tcase \"folder\": return fp.modeGetFolder;\n\t\t\tcase \"multiple\": return fp.modeOpenMultiple;\n\t\t\tdefault: return 0;\n\t\t}\n\t}\n\tgetFilterMask(fp) {\n\t\tswitch (this.filterMask) {\n\t\t\tcase \"all\": return fp.filterAll;\n\t\t\tcase \"html\": return fp.filterHTML;\n\t\t\tcase \"text\": return fp.filterText;\n\t\t\tcase \"images\": return fp.filterImages;\n\t\t\tcase \"xml\": return fp.filterXML;\n\t\t\tcase \"apps\": return fp.filterApps;\n\t\t\tcase \"urls\": return fp.filterAllowURLs;\n\t\t\tcase \"audio\": return fp.filterAudio;\n\t\t\tcase \"video\": return fp.filterVideo;\n\t\t\tdefault: return 1;\n\t\t}\n\t}\n};\n\n//#endregion\n//#region src/helpers/guide.ts\n/**\n* Helper for creating a guide.\n* Designed for creating a step-by-step guide for users.\n* @alpha\n*/\nvar GuideHelper = class extends BasicTool {\n\t_steps = [];\n\tconstructor() {\n\t\tsuper();\n\t}\n\taddStep(step) {\n\t\tthis._steps.push(step);\n\t\treturn this;\n\t}\n\taddSteps(steps) {\n\t\tthis._steps.push(...steps);\n\t\treturn this;\n\t}\n\tasync show(doc) {\n\t\tif (!doc?.ownerGlobal) throw new Error(\"Document is required.\");\n\t\tconst guide = new Guide(doc.ownerGlobal);\n\t\tawait guide.show(this._steps);\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tguide._panel.addEventListener(\"guide-finished\", () => resolve(guide));\n\t\t});\n\t\tawait promise;\n\t\treturn guide;\n\t}\n\tasync highlight(doc, step) {\n\t\tif (!doc?.ownerGlobal) throw new Error(\"Document is required.\");\n\t\tconst guide = new Guide(doc.ownerGlobal);\n\t\tawait guide.show([step]);\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tguide._panel.addEventListener(\"guide-finished\", () => resolve(guide));\n\t\t});\n\t\tawait promise;\n\t\treturn guide;\n\t}\n};\nvar Guide = class {\n\t_window;\n\t_id = `guide-${Zotero.Utilities.randomString()}`;\n\t_panel;\n\t_header;\n\t_body;\n\t_footer;\n\t_progress;\n\t_closeButton;\n\t_prevButton;\n\t_nextButton;\n\t_steps;\n\t_noClose;\n\t_closed;\n\t_autoNext;\n\t_currentIndex;\n\tinitialized;\n\t_cachedMasks = [];\n\tget content() {\n\t\treturn this._window.MozXULElement.parseXULToFragment(`\n      <panel id=\"${this._id}\" class=\"guide-panel\" type=\"arrow\" align=\"top\" noautohide=\"true\">\n          <html:div class=\"guide-panel-content\">\n              <html:div class=\"guide-panel-header\"></html:div>\n              <html:div class=\"guide-panel-body\"></html:div>\n              <html:div class=\"guide-panel-footer\">\n                  <html:div class=\"guide-panel-progress\"></html:div>\n                  <html:div class=\"guide-panel-buttons\">\n                      <button id=\"prev-button\" class=\"guide-panel-button\" hidden=\"true\"></button>\n                      <button id=\"next-button\" class=\"guide-panel-button\" hidden=\"true\"></button>\n                      <button id=\"close-button\" class=\"guide-panel-button\" hidden=\"true\"></button>\n                  </html:div>\n              </html:div>\n          </html:div>\n          <html:style>\n              .guide-panel {\n                  background-color: var(--material-menu);\n                  color: var(--fill-primary);\n              }\n              .guide-panel-content {\n                  display: flex;\n                  flex-direction: column;\n                  padding: 0;\n              }\n              .guide-panel-header {\n                  font-size: 1.2em;\n                  font-weight: bold;\n                  margin-bottom: 10px;\n              }\n              .guide-panel-header:empty {\n                display: none;\n              }\n              .guide-panel-body {\n                  align-items: center;\n                  display: flex;\n                  flex-direction: column;\n                  white-space: pre-wrap;\n              }\n              .guide-panel-body:empty {\n                display: none;\n              }\n              .guide-panel-footer {\n                  display: flex;\n                  flex-direction: row;\n                  align-items: center;\n                  justify-content: space-between;\n                  margin-top: 10px;\n              }\n              .guide-panel-progress {\n                  font-size: 0.8em;\n              }\n              .guide-panel-buttons {\n                  display: flex;\n                  flex-direction: row;\n                  flex-grow: 1;\n                  justify-content: flex-end;\n              }\n          </html:style>\n      </panel>\n  `);\n\t}\n\tget currentStep() {\n\t\tif (!this._steps) return void 0;\n\t\treturn this._steps[this._currentIndex];\n\t}\n\tget currentTarget() {\n\t\tconst step = this.currentStep;\n\t\tif (!step?.element) return void 0;\n\t\tlet elem;\n\t\tif (typeof step.element === \"function\") elem = step.element();\n\t\telse if (typeof step.element === \"string\") elem = this._window.document.querySelector(step.element);\n\t\telse if (!step.element) elem = this._window.document.documentElement || void 0;\n\t\telse elem = step.element;\n\t\treturn elem;\n\t}\n\tget hasNext() {\n\t\treturn this._steps && this._currentIndex < this._steps.length - 1;\n\t}\n\tget hasPrevious() {\n\t\treturn this._steps && this._currentIndex > 0;\n\t}\n\tget hookProps() {\n\t\treturn {\n\t\t\tconfig: this.currentStep,\n\t\t\tstate: {\n\t\t\t\tstep: this._currentIndex,\n\t\t\t\tsteps: this._steps,\n\t\t\t\tcontroller: this\n\t\t\t}\n\t\t};\n\t}\n\tget panel() {\n\t\treturn this._panel;\n\t}\n\tconstructor(win) {\n\t\tthis._window = win;\n\t\tthis._noClose = false;\n\t\tthis._closed = false;\n\t\tthis._autoNext = true;\n\t\tthis._currentIndex = 0;\n\t\tconst doc = win.document;\n\t\tconst content = this.content;\n\t\tif (content) doc.documentElement?.append(doc.importNode(content, true));\n\t\tthis._panel = doc.querySelector(`#${this._id}`);\n\t\tthis._header = this._panel.querySelector(\".guide-panel-header\");\n\t\tthis._body = this._panel.querySelector(\".guide-panel-body\");\n\t\tthis._footer = this._panel.querySelector(\".guide-panel-footer\");\n\t\tthis._progress = this._panel.querySelector(\".guide-panel-progress\");\n\t\tthis._closeButton = this._panel.querySelector(\"#close-button\");\n\t\tthis._prevButton = this._panel.querySelector(\"#prev-button\");\n\t\tthis._nextButton = this._panel.querySelector(\"#next-button\");\n\t\tthis._closeButton.addEventListener(\"click\", async () => {\n\t\t\tif (this.currentStep?.onCloseClick) await this.currentStep.onCloseClick(this.hookProps);\n\t\t\tthis.abort();\n\t\t});\n\t\tthis._prevButton.addEventListener(\"click\", async () => {\n\t\t\tif (this.currentStep?.onPrevClick) await this.currentStep.onPrevClick(this.hookProps);\n\t\t\tthis.movePrevious();\n\t\t});\n\t\tthis._nextButton.addEventListener(\"click\", async () => {\n\t\t\tif (this.currentStep?.onNextClick) await this.currentStep.onNextClick(this.hookProps);\n\t\t\tthis.moveNext();\n\t\t});\n\t\tthis._panel.addEventListener(\"popupshown\", this._handleShown.bind(this));\n\t\tthis._panel.addEventListener(\"popuphidden\", this._handleHidden.bind(this));\n\t\tthis._window.addEventListener(\"resize\", this._centerPanel);\n\t}\n\tasync show(steps) {\n\t\tif (steps) {\n\t\t\tthis._steps = steps;\n\t\t\tthis._currentIndex = 0;\n\t\t}\n\t\tconst index = this._currentIndex;\n\t\tthis._noClose = false;\n\t\tthis._closed = false;\n\t\tthis._autoNext = true;\n\t\tconst step = this.currentStep;\n\t\tif (!step) return;\n\t\tconst elem = this.currentTarget;\n\t\tif (step.onBeforeRender) {\n\t\t\tawait step.onBeforeRender(this.hookProps);\n\t\t\tif (index !== this._currentIndex) {\n\t\t\t\tawait this.show();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (step.onMask) step.onMask({ mask: (_e) => this._createMask(_e) });\n\t\telse this._createMask(elem);\n\t\tlet x;\n\t\tlet y = 0;\n\t\tlet position = step.position || \"after_start\";\n\t\tif (position === \"center\") {\n\t\t\tposition = \"overlap\";\n\t\t\tx = this._window.innerWidth / 2;\n\t\t\ty = this._window.innerHeight / 2;\n\t\t}\n\t\tthis._panel.openPopup(elem, step.position || \"after_start\", x, y, false, false);\n\t}\n\thide() {\n\t\tthis._panel.hidePopup();\n\t}\n\tabort() {\n\t\tthis._closed = true;\n\t\tthis.hide();\n\t\tthis._steps = void 0;\n\t}\n\tmoveTo(stepIndex) {\n\t\tif (!this._steps) {\n\t\t\tthis.hide();\n\t\t\treturn;\n\t\t}\n\t\tif (stepIndex < 0) stepIndex = 0;\n\t\tif (!this._steps[stepIndex]) {\n\t\t\tthis._currentIndex = this._steps.length;\n\t\t\tthis.hide();\n\t\t\treturn;\n\t\t}\n\t\tthis._autoNext = false;\n\t\tthis._noClose = true;\n\t\tthis.hide();\n\t\tthis._noClose = false;\n\t\tthis._autoNext = true;\n\t\tthis._currentIndex = stepIndex;\n\t\tthis.show();\n\t}\n\tmoveNext() {\n\t\tthis.moveTo(this._currentIndex + 1);\n\t}\n\tmovePrevious() {\n\t\tthis.moveTo(this._currentIndex - 1);\n\t}\n\t_handleShown() {\n\t\tif (!this._steps) return;\n\t\tconst step = this.currentStep;\n\t\tif (!step) return;\n\t\tthis._header.innerHTML = step.title || \"\";\n\t\tthis._body.innerHTML = step.description || \"\";\n\t\tthis._panel.querySelectorAll(\".guide-panel-button\").forEach((elem) => {\n\t\t\telem.hidden = true;\n\t\t\telem.disabled = false;\n\t\t});\n\t\tlet showButtons = step.showButtons;\n\t\tif (!showButtons) {\n\t\t\tshowButtons = [];\n\t\t\tif (this.hasPrevious) showButtons.push(\"prev\");\n\t\t\tif (this.hasNext) showButtons.push(\"next\");\n\t\t\telse showButtons.push(\"close\");\n\t\t}\n\t\tif (showButtons?.length) showButtons.forEach((btn) => {\n\t\t\tthis._panel.querySelector(`#${btn}-button`).hidden = false;\n\t\t});\n\t\tif (step.disableButtons) step.disableButtons.forEach((btn) => {\n\t\t\tthis._panel.querySelector(`#${btn}-button`).disabled = true;\n\t\t});\n\t\tif (step.showProgress) {\n\t\t\tthis._progress.hidden = false;\n\t\t\tthis._progress.textContent = step.progressText || `${this._currentIndex + 1}/${this._steps.length}`;\n\t\t} else this._progress.hidden = true;\n\t\tthis._closeButton.label = step.closeBtnText || \"Done\";\n\t\tthis._nextButton.label = step.nextBtnText || \"Next\";\n\t\tthis._prevButton.label = step.prevBtnText || \"Previous\";\n\t\tif (step.onRender) step.onRender(this.hookProps);\n\t\tif (step.position === \"center\") {\n\t\t\tthis._centerPanel();\n\t\t\tthis._window.setTimeout(this._centerPanel, 10);\n\t\t}\n\t}\n\tasync _handleHidden() {\n\t\tthis._removeMask();\n\t\tthis._header.innerHTML = \"\";\n\t\tthis._body.innerHTML = \"\";\n\t\tthis._progress.textContent = \"\";\n\t\tif (!this._steps) return;\n\t\tconst step = this.currentStep;\n\t\tif (step && step.onExit) await step.onExit(this.hookProps);\n\t\tif (!this._noClose && (this._closed || !this.hasNext)) {\n\t\t\tthis._panel.dispatchEvent(new this._window.CustomEvent(\"guide-finished\"));\n\t\t\tthis._panel.remove();\n\t\t\tthis._window.removeEventListener(\"resize\", this._centerPanel);\n\t\t\treturn;\n\t\t}\n\t\tif (this._autoNext) this.moveNext();\n\t}\n\t_centerPanel = () => {\n\t\tconst win = this._window;\n\t\tthis._panel.moveTo(win.screenX + win.innerWidth / 2 - this._panel.clientWidth / 2, win.screenY + win.innerHeight / 2 - this._panel.clientHeight / 2);\n\t};\n\t_createMask(targetElement) {\n\t\tconst doc = targetElement?.ownerDocument || this._window.document;\n\t\tconst NS = \"http://www.w3.org/2000/svg\";\n\t\tconst svg = doc.createElementNS(NS, \"svg\");\n\t\tsvg.id = \"guide-panel-mask\";\n\t\tsvg.style.position = \"fixed\";\n\t\tsvg.style.top = \"0\";\n\t\tsvg.style.left = \"0\";\n\t\tsvg.style.width = \"100%\";\n\t\tsvg.style.height = \"100%\";\n\t\tsvg.style.zIndex = \"9999\";\n\t\tconst mask = doc.createElementNS(NS, \"mask\");\n\t\tmask.id = \"mask\";\n\t\tconst fullRect = doc.createElementNS(NS, \"rect\");\n\t\tfullRect.setAttribute(\"x\", \"0\");\n\t\tfullRect.setAttribute(\"y\", \"0\");\n\t\tfullRect.setAttribute(\"width\", \"100%\");\n\t\tfullRect.setAttribute(\"height\", \"100%\");\n\t\tfullRect.setAttribute(\"fill\", \"white\");\n\t\tmask.appendChild(fullRect);\n\t\tif (targetElement) {\n\t\t\tconst rect = targetElement.getBoundingClientRect();\n\t\t\tconst targetRect = doc.createElementNS(NS, \"rect\");\n\t\t\ttargetRect.setAttribute(\"x\", rect.left.toString());\n\t\t\ttargetRect.setAttribute(\"y\", rect.top.toString());\n\t\t\ttargetRect.setAttribute(\"width\", rect.width.toString());\n\t\t\ttargetRect.setAttribute(\"height\", rect.height.toString());\n\t\t\ttargetRect.setAttribute(\"fill\", \"black\");\n\t\t\tmask.appendChild(targetRect);\n\t\t}\n\t\tconst maskedRect = doc.createElementNS(NS, \"rect\");\n\t\tmaskedRect.setAttribute(\"x\", \"0\");\n\t\tmaskedRect.setAttribute(\"y\", \"0\");\n\t\tmaskedRect.setAttribute(\"width\", \"100%\");\n\t\tmaskedRect.setAttribute(\"height\", \"100%\");\n\t\tmaskedRect.setAttribute(\"mask\", \"url(#mask)\");\n\t\tmaskedRect.setAttribute(\"opacity\", \"0.7\");\n\t\tsvg.appendChild(mask);\n\t\tsvg.appendChild(maskedRect);\n\t\tthis._cachedMasks.push(new WeakRef(svg));\n\t\tdoc.documentElement?.appendChild(svg);\n\t}\n\t_removeMask() {\n\t\tthis._cachedMasks.forEach((ref) => {\n\t\t\tconst mask = ref.deref();\n\t\t\tif (mask) mask.remove();\n\t\t});\n\t\tthis._cachedMasks = [];\n\t}\n};\n\n//#endregion\n//#region src/helpers/largePref.ts\n/**\n* Helper class for storing large amounts of data in Zotero preferences.\n*\n* @remarks\n* The allowed data length for a single preference is at least 100k,\n* but if this can grow infinitely, like an Array or an Object,\n* there will be significant performance problems.\n*\n* This class stores the keys of data in a single preference as a JSON string of Array,\n* and stores the values of data in separate preferences.\n*\n* You can either use the class as a normal object with `asObject()`,\n* or use the methods to access the data.\n*/\nvar LargePrefHelper = class extends BasicTool {\n\tkeyPref;\n\tvaluePrefPrefix;\n\tinnerObj;\n\thooks;\n\t/**\n\t*\n\t* @param keyPref The preference name for storing the keys of the data.\n\t* @param valuePrefPrefix The preference name prefix for storing the values of the data.\n\t* @param hooks Hooks for parsing the values of the data.\n\t* - `afterGetValue`: A function that takes the value of the data as input and returns the parsed value.\n\t* - `beforeSetValue`: A function that takes the key and value of the data as input and returns the parsed key and value.\n\t* If `hooks` is `\"default\"`, no parsing will be done.\n\t* If `hooks` is `\"parser\"`, the values will be parsed as JSON.\n\t* If `hooks` is an object, the values will be parsed by the hooks.\n\t*/\n\tconstructor(keyPref, valuePrefPrefix, hooks = \"default\") {\n\t\tsuper();\n\t\tthis.keyPref = keyPref;\n\t\tthis.valuePrefPrefix = valuePrefPrefix;\n\t\tif (hooks === \"default\") this.hooks = defaultHooks;\n\t\telse if (hooks === \"parser\") this.hooks = parserHooks;\n\t\telse this.hooks = {\n\t\t\t...defaultHooks,\n\t\t\t...hooks\n\t\t};\n\t\tthis.innerObj = {};\n\t}\n\t/**\n\t* Get the object that stores the data.\n\t* @returns The object that stores the data.\n\t*/\n\tasObject() {\n\t\treturn this.constructTempObj();\n\t}\n\t/**\n\t* Get the Map that stores the data.\n\t* @returns The Map that stores the data.\n\t*/\n\tasMapLike() {\n\t\tconst mapLike = {\n\t\t\tget: (key) => this.getValue(key),\n\t\t\tset: (key, value) => {\n\t\t\t\tthis.setValue(key, value);\n\t\t\t\treturn mapLike;\n\t\t\t},\n\t\t\thas: (key) => this.hasKey(key),\n\t\t\tdelete: (key) => this.deleteKey(key),\n\t\t\tclear: () => {\n\t\t\t\tfor (const key of this.getKeys()) this.deleteKey(key);\n\t\t\t},\n\t\t\tforEach: (callback) => {\n\t\t\t\treturn this.constructTempMap().forEach(callback);\n\t\t\t},\n\t\t\tget size() {\n\t\t\t\treturn this._this.getKeys().length;\n\t\t\t},\n\t\t\tentries: () => {\n\t\t\t\treturn this.constructTempMap().values();\n\t\t\t},\n\t\t\tkeys: () => {\n\t\t\t\tconst keys = this.getKeys();\n\t\t\t\treturn keys[Symbol.iterator]();\n\t\t\t},\n\t\t\tvalues: () => {\n\t\t\t\treturn this.constructTempMap().values();\n\t\t\t},\n\t\t\t[Symbol.iterator]: () => {\n\t\t\t\treturn this.constructTempMap()[Symbol.iterator]();\n\t\t\t},\n\t\t\t[Symbol.toStringTag]: \"MapLike\",\n\t\t\t_this: this\n\t\t};\n\t\treturn mapLike;\n\t}\n\t/**\n\t* Get the keys of the data.\n\t* @returns The keys of the data.\n\t*/\n\tgetKeys() {\n\t\tconst rawKeys = Zotero.Prefs.get(this.keyPref, true);\n\t\tconst keys = rawKeys ? JSON.parse(rawKeys) : [];\n\t\tfor (const key of keys) {\n\t\t\tconst value = \"placeholder\";\n\t\t\tthis.innerObj[key] = value;\n\t\t}\n\t\treturn keys;\n\t}\n\t/**\n\t* Set the keys of the data.\n\t* @param keys The keys of the data.\n\t*/\n\tsetKeys(keys) {\n\t\tkeys = [...new Set(keys.filter((key) => key))];\n\t\tZotero.Prefs.set(this.keyPref, JSON.stringify(keys), true);\n\t\tfor (const key of keys) {\n\t\t\tconst value = \"placeholder\";\n\t\t\tthis.innerObj[key] = value;\n\t\t}\n\t}\n\t/**\n\t* Get the value of a key.\n\t* @param key The key of the data.\n\t* @returns The value of the key.\n\t*/\n\tgetValue(key) {\n\t\tconst value = Zotero.Prefs.get(`${this.valuePrefPrefix}${key}`, true);\n\t\tif (typeof value === \"undefined\") return;\n\t\tconst { value: newValue } = this.hooks.afterGetValue({ value });\n\t\tthis.innerObj[key] = newValue;\n\t\treturn newValue;\n\t}\n\t/**\n\t* Set the value of a key.\n\t* @param key The key of the data.\n\t* @param value The value of the key.\n\t*/\n\tsetValue(key, value) {\n\t\tconst { key: newKey, value: newValue } = this.hooks.beforeSetValue({\n\t\t\tkey,\n\t\t\tvalue\n\t\t});\n\t\tthis.setKey(newKey);\n\t\tZotero.Prefs.set(`${this.valuePrefPrefix}${newKey}`, newValue, true);\n\t\tthis.innerObj[newKey] = newValue;\n\t}\n\t/**\n\t* Check if a key exists.\n\t* @param key The key of the data.\n\t* @returns Whether the key exists.\n\t*/\n\thasKey(key) {\n\t\treturn this.getKeys().includes(key);\n\t}\n\t/**\n\t* Add a key.\n\t* @param key The key of the data.\n\t*/\n\tsetKey(key) {\n\t\tconst keys = this.getKeys();\n\t\tif (!keys.includes(key)) {\n\t\t\tkeys.push(key);\n\t\t\tthis.setKeys(keys);\n\t\t}\n\t}\n\t/**\n\t* Delete a key.\n\t* @param key The key of the data.\n\t*/\n\tdeleteKey(key) {\n\t\tconst keys = this.getKeys();\n\t\tconst index = keys.indexOf(key);\n\t\tif (index > -1) {\n\t\t\tkeys.splice(index, 1);\n\t\t\tdelete this.innerObj[key];\n\t\t\tthis.setKeys(keys);\n\t\t}\n\t\tZotero.Prefs.clear(`${this.valuePrefPrefix}${key}`, true);\n\t\treturn true;\n\t}\n\tconstructTempObj() {\n\t\treturn new Proxy(this.innerObj, {\n\t\t\tget: (target, prop, receiver) => {\n\t\t\t\tthis.getKeys();\n\t\t\t\tif (typeof prop === \"string\" && prop in target) this.getValue(prop);\n\t\t\t\treturn Reflect.get(target, prop, receiver);\n\t\t\t},\n\t\t\tset: (target, p, newValue, receiver) => {\n\t\t\t\tif (typeof p === \"string\") {\n\t\t\t\t\tif (newValue === void 0) {\n\t\t\t\t\t\tthis.deleteKey(p);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tthis.setValue(p, newValue);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn Reflect.set(target, p, newValue, receiver);\n\t\t\t},\n\t\t\thas: (target, p) => {\n\t\t\t\tthis.getKeys();\n\t\t\t\treturn Reflect.has(target, p);\n\t\t\t},\n\t\t\tdeleteProperty: (target, p) => {\n\t\t\t\tif (typeof p === \"string\") {\n\t\t\t\t\tthis.deleteKey(p);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn Reflect.deleteProperty(target, p);\n\t\t\t}\n\t\t});\n\t}\n\tconstructTempMap() {\n\t\tconst map = /* @__PURE__ */ new Map();\n\t\tfor (const key of this.getKeys()) map.set(key, this.getValue(key));\n\t\treturn map;\n\t}\n};\nconst defaultHooks = {\n\tafterGetValue: ({ value }) => ({ value }),\n\tbeforeSetValue: ({ key, value }) => ({\n\t\tkey,\n\t\tvalue\n\t})\n};\nconst parserHooks = {\n\tafterGetValue: ({ value }) => {\n\t\ttry {\n\t\t\tvalue = JSON.parse(value);\n\t\t} catch {\n\t\t\treturn { value };\n\t\t}\n\t\treturn { value };\n\t},\n\tbeforeSetValue: ({ key, value }) => {\n\t\tvalue = JSON.stringify(value);\n\t\treturn {\n\t\t\tkey,\n\t\t\tvalue\n\t\t};\n\t}\n};\n\n//#endregion\n//#region src/helpers/message.ts\nfunction randomJobID() {\n\treturn `${Math.random().toString(36).substring(2, 15)}-${Date.now()}`;\n}\nfunction getProperty(obj, path) {\n\tif (path === \"\") return obj;\n\tconst parts = path.split(\".\");\n\tlet value = obj;\n\tfor (const part of parts) {\n\t\tvalue = value[part];\n\t\tif (typeof value === \"undefined\") throw new TypeError(`Property ${path} not found`);\n\t}\n\treturn value;\n}\nfunction logError(e) {\n\tif (typeof self !== \"undefined\") self.console.warn(e);\n\telse if (typeof console !== \"undefined\") console.warn(e);\n\telse if (typeof Zotero !== \"undefined\") Zotero.warn(e);\n}\n/**\n* Helper class to manage messages between workers/iframes and their parent\n* @beta\n*\n* @example\n* Use the `MessageHelper` to create a server that can be used to communicate between workers or iframes and their parent.\n*\n* In the child `worker.js`:\n* ```typescript\n* const handlers = {\n*   async test() {\n*     return \"test\";\n*   },\n* };\n* // Create a new server\n* const server = new MessageHelper({\n*   name: \"child\",\n*   handlers,\n*   canBeDestroyed: true,\n* });\n* // Start the listener\n* server.start();\n* // Export the handlers for type hinting\n* export { handlers };\n* ```\n* In the parent:\n* ```typescript\n* // Import the handlers\n* import type { handlers } from \"./worker.js\";\n* // Create a new worker\n* const worker = new Worker(\"worker.js\");\n* // Create a new server with the type from the target handlers\n* const server = new MessageHelper<typeof handlers>({\n*   name: \"worker\",\n*   handlers: {\n*     async test() {\n*       return \"test\";\n*     },\n*   },\n*   target: worker,\n* });\n* server.start();\n* // Execute the handlers defined in the worker as if they were local\n* ztoolkit.log(await server.proxy.test());\n* // ...\n* // Stop the server, can be restarted with server.start()\n* server.stop();\n* // Destroy the server and the worker\n* server.destroy();\n* ```\n*\n* @example\n* Evaluate code in the other side of the server\n* ```typescript\n* await server.eval(\"self.firstName = 'John';\");\n* ```\n*\n* @example\n* Get a property from the other side of the server, can be nested.\n*\n* Only works if the property is a primitive or a serializable object\n* ```typescript\n* ztoolkit.log(await server.get(\"self.firstName\"));\n* ```\n*\n* @example\n* Set a property from the other side of the server, can be nested.\n*\n* Only works if the property is a primitive or a serializable object\n* ```typescript\n* await server.set(\"self.firstName\", \"Alice\");\n* ```\n*\n* @example\n* Check if the target is alive\n* ```typescript\n* ztoolkit.log(await server.isTargetAlive());\n* // Alternatively, send a ping message\n* ztoolkit.log(await server.proxy._ping());\n* ```\n*/\nvar MessageHelper = class {\n\tconfig;\n\tenv;\n\tlistener;\n\trunning = false;\n\t/**\n\t* Proxy object to call the message handlers\n\t*/\n\tproxy = new Proxy({}, { get: (target, prop) => {\n\t\treturn async (...args) => {\n\t\t\treturn await this.exec(prop, args);\n\t\t};\n\t} });\n\tget target() {\n\t\treturn this.config.target;\n\t}\n\tget privileged() {\n\t\treturn [\"browser\", \"chromeworker\"].includes(this.env);\n\t}\n\tconstructor(config) {\n\t\tif (!config.target) config.target = self;\n\t\tif (typeof config.dev === \"undefined\") config.dev = false;\n\t\tthis.config = config;\n\t\tthis.config.handlers = {\n\t\t\t...this.config.handlers,\n\t\t\t_start: async () => {\n\t\t\t\tthis.start();\n\t\t\t},\n\t\t\t_stop: async () => {\n\t\t\t\tthis.stop();\n\t\t\t},\n\t\t\t_destroy: async () => {\n\t\t\t\tthis.destroy();\n\t\t\t},\n\t\t\t_ping: async () => {\n\t\t\t\treturn \"pong\";\n\t\t\t},\n\t\t\t_call: async (func, args) => {\n\t\t\t\tconst funcObj = getProperty(self, func);\n\t\t\t\treturn await funcObj(...args);\n\t\t\t},\n\t\t\t_get: async (key) => {\n\t\t\t\treturn await getProperty(self, key);\n\t\t\t},\n\t\t\t_set: async (key, value) => {\n\t\t\t\tconst parts = key.split(\".\");\n\t\t\t\tconst last = parts.pop();\n\t\t\t\tconst obj = getProperty(self, parts.join(\".\"));\n\t\t\t\tobj[last] = value;\n\t\t\t},\n\t\t\t_eval: async (code) => {\n\t\t\t\tconst AsyncFunction = Object.getPrototypeOf(async () => {}).constructor;\n\t\t\t\tconst fn = new AsyncFunction(\"self\", code);\n\t\t\t\treturn await fn(self);\n\t\t\t}\n\t\t};\n\t\tthis.config.target.addEventListener(\"unload\", () => {\n\t\t\tthis.destroy();\n\t\t}, { once: true });\n\t\tif (typeof window !== \"undefined\") if (typeof window.browsingContext !== \"undefined\") this.env = \"browser\";\n\t\telse this.env = \"content\";\n\t\telse if (typeof ctypes !== \"undefined\") this.env = \"chromeworker\";\n\t\telse this.env = \"webworker\";\n\t}\n\tstart() {\n\t\tif (this.running) {\n\t\t\tlogError(`Listener already started for ${this.config.name}`);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.listener) this.listener = async (event) => {\n\t\t\tconst { data } = event;\n\t\t\tif (typeof data !== \"object\" || data === null) return;\n\t\t\tconst { _jobID, _senderName, _handlerName, _handlerData, _requestReturn } = data;\n\t\t\tif (_senderName === this.config.name) return;\n\t\t\tif (!_handlerName) return;\n\t\t\tif (!this.running && _handlerName !== \"_start\") {\n\t\t\t\tlogError(`Server not started for ${this.config.name}, ignoring message ${_handlerName}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst handler = this.config.handlers[_handlerName];\n\t\t\tif (!handler) {\n\t\t\t\tif (!_handlerName.endsWith(\"::return\")) logError(`Handler ${_handlerName} not found for ${this.config.name}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst res = await handler(..._handlerData || []);\n\t\t\t\tif (_requestReturn) this.send({\n\t\t\t\t\tname: `${_handlerName}::return`,\n\t\t\t\t\tdata: res,\n\t\t\t\t\tjobID: _jobID,\n\t\t\t\t\trequestReturn: false\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tlogError(`Error in handler ${_handlerName} for ${this.config.name}, ${e}`);\n\t\t\t\tif (_requestReturn) this.send({\n\t\t\t\t\tname: `${_handlerName}::return`,\n\t\t\t\t\tdata: String(e),\n\t\t\t\t\tjobID: _jobID,\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\trequestReturn: false\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis.config.target?.addEventListener(\"message\", this.listener);\n\t\tthis.running = true;\n\t}\n\tstop() {\n\t\tif (!this.running) {\n\t\t\tlogError(`Listener already stopped for ${this.config.name}`);\n\t\t\treturn;\n\t\t}\n\t\tthis.running = false;\n\t}\n\tdestroy() {\n\t\tthis.stop();\n\t\tif (!this.listener) {\n\t\t\tlogError(`Listener already destroyed for ${this.config.name}`);\n\t\t\treturn;\n\t\t}\n\t\tthis.config.target?.removeEventListener(\"message\", this.listener);\n\t\tif (this.config.canBeDestroyed && this.config.target === self) {\n\t\t\tif (this.config.dev) logError(`Destroying window ${this.config.name}`);\n\t\t\tself.close();\n\t\t}\n\t}\n\tasync exec(name, params, options = {}) {\n\t\tconst { timeout = 5e3 } = options;\n\t\tlet resolved = false;\n\t\tconst target = this.config.target;\n\t\tconst jobID = await this.send({\n\t\t\tname,\n\t\t\tdata: params || []\n\t\t});\n\t\treturn new Promise((resolve) => {\n\t\t\tconst handler = function(event) {\n\t\t\t\tif (resolved) return;\n\t\t\t\tconst { _handlerName, _jobID: returnJobID, _handlerData } = event.data;\n\t\t\t\tif (_handlerName !== `${name}::return` || returnJobID !== jobID) return;\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttarget.removeEventListener(\"message\", handler);\n\t\t\t\tresolve(_handlerData);\n\t\t\t};\n\t\t\ttarget.addEventListener(\"message\", handler);\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tif (resolved) return;\n\t\t\t\tlogError(`Timeout for ${name} in ${this.config.name}`);\n\t\t\t\tresolved = true;\n\t\t\t\ttarget.removeEventListener(\"message\", handler);\n\t\t\t\tresolve(void 0);\n\t\t\t}, timeout);\n\t\t});\n\t}\n\tasync call(func, args) {\n\t\treturn await this.exec(\"_call\", [func, args]);\n\t}\n\tasync get(key) {\n\t\treturn await this.exec(\"_get\", [key]);\n\t}\n\tasync set(key, value) {\n\t\treturn await this.exec(\"_set\", [key, value]);\n\t}\n\tasync eval(code) {\n\t\treturn await this.exec(\"_eval\", [code]);\n\t}\n\tasync send(options) {\n\t\tconst { name, data: params } = options;\n\t\tlet { jobID, success, requestReturn } = options;\n\t\tif (!jobID) jobID = randomJobID();\n\t\tif (typeof success === \"undefined\") success = true;\n\t\tif (typeof requestReturn === \"undefined\") requestReturn = true;\n\t\tif (this.config.dev) logError(`Sending message ${name} from ${this.config.name}, ${(/* @__PURE__ */ new Date()).toISOString()}`);\n\t\tconst message = {\n\t\t\t_jobID: jobID,\n\t\t\t_senderName: this.config.name,\n\t\t\t_handlerName: name,\n\t\t\t_requestReturn: requestReturn,\n\t\t\t_handlerData: params\n\t\t};\n\t\tthis.config.target.postMessage(message);\n\t\treturn jobID;\n\t}\n\tasync isTargetAlive() {\n\t\tif (!this.target) return false;\n\t\tif (typeof this.target.closed !== \"undefined\") return !this.target.closed;\n\t\telse {\n\t\t\tconst ret = await this.exec(\"_ping\", void 0, { timeout: 200 });\n\t\t\treturn ret === \"pong\";\n\t\t}\n\t}\n};\n\n//#endregion\n//#region src/helpers/patch.ts\nvar PatchHelper = class extends BasicTool {\n\toptions;\n\tconstructor() {\n\t\tsuper();\n\t\tthis.options = void 0;\n\t}\n\tsetData(options) {\n\t\tthis.options = options;\n\t\tconst Zotero$1 = this.getGlobal(\"Zotero\");\n\t\tconst { target, funcSign, patcher } = options;\n\t\tconst origin = target[funcSign];\n\t\tthis.log(\"patching \", funcSign);\n\t\ttarget[funcSign] = function(...args) {\n\t\t\tif (options.enabled) try {\n\t\t\t\treturn patcher(origin).apply(this, args);\n\t\t\t} catch (e) {\n\t\t\t\tZotero$1.logError(e);\n\t\t\t}\n\t\t\treturn origin.apply(this, args);\n\t\t};\n\t\treturn this;\n\t}\n\tenable() {\n\t\tif (!this.options) throw new Error(\"No patch data set\");\n\t\tthis.options.enabled = true;\n\t\treturn this;\n\t}\n\tdisable() {\n\t\tif (!this.options) throw new Error(\"No patch data set\");\n\t\tthis.options.enabled = false;\n\t\treturn this;\n\t}\n};\n\n//#endregion\n//#region src/helpers/progressWindow.ts\n/**\n* Icon dict. Add your custom icons here.\n* @default\n* ```ts\n* {\n*   success: \"chrome://zotero/skin/tick.png\",\n*   fail: \"chrome://zotero/skin/cross.png\",\n* };\n* ```\n*/\nconst icons = {\n\tsuccess: \"chrome://zotero/skin/tick.png\",\n\tfail: \"chrome://zotero/skin/cross.png\"\n};\n/**\n* ProgressWindow helper.\n* @example\n* Show a popup with success icon\n* ```ts\n* const tool = new ZoteroTool();\n* tool.createProgressWindow(\"Addon\").createLine({\n*   type: \"success\",\n*   text: \"Finish\"\n*   progress: 100,\n* }).show();\n* ```\n* @example\n* Show a popup and change line content\n* ```ts\n* const compat = new ZoteroCompat();\n* const tool = new ZoteroTool();\n* const popupWin = tool.createProgressWindow(\"Addon\").createLine({\n*   text: \"Loading\"\n*   progress: 50,\n* }).show(-1);\n* // Do operations\n* compat.getGlobal(\"setTimeout\")(()=>{\n*   popupWin.changeLine({\n*     text: \"Finish\",\n*     progress: 100,\n*   });\n* }, 3000);\n* ```\n*/\nvar ProgressWindowHelper = class {\n\twin;\n\tlines;\n\tcloseTime;\n\t/**\n\t*\n\t* @param header window header\n\t* @param options\n\t* @param options.window\n\t* @param options.closeOnClick\n\t* @param options.closeTime\n\t* @param options.closeOtherProgressWindows\n\t*/\n\tconstructor(header, options = {\n\t\tcloseOnClick: true,\n\t\tcloseTime: 5e3\n\t}) {\n\t\tthis.win = new (BasicTool.getZotero()).ProgressWindow(options);\n\t\tthis.lines = [];\n\t\tthis.closeTime = options.closeTime || 5e3;\n\t\tthis.win.changeHeadline(header);\n\t\tif (options.closeOtherProgressWindows) BasicTool.getZotero().ProgressWindowSet.closeAll();\n\t}\n\t/**\n\t* Create a new line\n\t* @param options\n\t* @param options.type\n\t* @param options.icon\n\t* @param options.text\n\t* @param options.progress\n\t* @param options.idx\n\t*/\n\tcreateLine(options) {\n\t\tconst icon = this.getIcon(options.type, options.icon);\n\t\tconst line = new this.win.ItemProgress(icon || \"\", options.text || \"\");\n\t\tif (typeof options.progress === \"number\") line.setProgress(options.progress);\n\t\tthis.lines.push(line);\n\t\tthis.updateIcons();\n\t\treturn this;\n\t}\n\t/**\n\t* Change the line content\n\t* @param options\n\t* @param options.type\n\t* @param options.icon\n\t* @param options.text\n\t* @param options.progress\n\t* @param options.idx\n\t*/\n\tchangeLine(options) {\n\t\tif (this.lines?.length === 0) return this;\n\t\tconst idx = typeof options.idx !== \"undefined\" && options.idx >= 0 && options.idx < this.lines.length ? options.idx : 0;\n\t\tconst icon = this.getIcon(options.type, options.icon);\n\t\tif (icon) this.lines[idx].setItemTypeAndIcon(icon);\n\t\toptions.text && this.lines[idx].setText(options.text);\n\t\ttypeof options.progress === \"number\" && this.lines[idx].setProgress(options.progress);\n\t\tthis.updateIcons();\n\t\treturn this;\n\t}\n\tshow(closeTime = void 0) {\n\t\tthis.win.show();\n\t\ttypeof closeTime !== \"undefined\" && (this.closeTime = closeTime);\n\t\tif (this.closeTime && this.closeTime > 0) this.win.startCloseTimer(this.closeTime);\n\t\tsetTimeout(this.updateIcons.bind(this), 50);\n\t\treturn this;\n\t}\n\t/**\n\t* Set custom icon uri for progress window\n\t* @param key\n\t* @param uri\n\t*/\n\tstatic setIconURI(key, uri) {\n\t\ticons[key] = uri;\n\t}\n\tgetIcon(type, defaultIcon) {\n\t\treturn type && type in icons ? icons[type] : defaultIcon;\n\t}\n\tupdateIcons() {\n\t\ttry {\n\t\t\tthis.lines.forEach((line) => {\n\t\t\t\tconst box = line._image;\n\t\t\t\tconst icon = box.dataset.itemType;\n\t\t\t\tif (icon && !box.style.backgroundImage.includes(\"progress_arcs\")) box.style.backgroundImage = `url(${box.dataset.itemType})`;\n\t\t\t});\n\t\t} catch {}\n\t}\n\tchangeHeadline(text, icon, postText) {\n\t\tthis.win.changeHeadline(text, icon, postText);\n\t\treturn this;\n\t}\n\taddLines(labels, icons$1) {\n\t\tthis.win.addLines(labels, icons$1);\n\t\treturn this;\n\t}\n\taddDescription(text) {\n\t\tthis.win.addDescription(text);\n\t\treturn this;\n\t}\n\tstartCloseTimer(ms, requireMouseOver) {\n\t\tthis.win.startCloseTimer(ms, requireMouseOver);\n\t\treturn this;\n\t}\n\tclose() {\n\t\tthis.win.close();\n\t\treturn this;\n\t}\n};\n\n//#endregion\n//#region src/helpers/settingsDialog.ts\n/**\n* Settings dialog helper. Extends DialogHelper with setting management capabilities.\n*/\nvar SettingsDialogHelper = class extends DialogHelper {\n\tsettingsHandlers = null;\n\tautoSaveButtonIds = /* @__PURE__ */ new Set();\n\tsettingBindings = /* @__PURE__ */ new Map();\n\t/**\n\t* Create a settings dialog helper.\n\t* Uses a 2-column grid layout by default (label column + control column)\n\t*/\n\tconstructor() {\n\t\tsuper(1, 2);\n\t\tthis.elementProps = {\n\t\t\ttag: \"vbox\",\n\t\t\tattributes: { flex: 1 },\n\t\t\tstyles: {\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\t\t\t\tpadding: \"20px\"\n\t\t\t},\n\t\t\tchildren: [{\n\t\t\t\ttag: \"div\",\n\t\t\t\tclassList: [\"settings-grid\"],\n\t\t\t\tstyles: {\n\t\t\t\t\tdisplay: \"grid\",\n\t\t\t\t\tgridTemplateColumns: \"auto 1fr\",\n\t\t\t\t\tgap: \"15px 20px\",\n\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\tmarginBottom: \"20px\"\n\t\t\t\t},\n\t\t\t\tchildren: []\n\t\t\t}, {\n\t\t\t\ttag: \"hbox\",\n\t\t\t\tattributes: {\n\t\t\t\t\tflex: 0,\n\t\t\t\t\tpack: \"end\"\n\t\t\t\t},\n\t\t\t\tstyles: { marginTop: \"20px\" },\n\t\t\t\tchildren: []\n\t\t\t}]\n\t\t};\n\t}\n\t/**\n\t* Set the setting handlers for getting and setting values.\n\t* @param getSetting Function to get a setting value by key\n\t* @param setSetting Function to set a setting value by key\n\t*/\n\tsetSettingHandlers(getSetting, setSetting) {\n\t\tthis.settingsHandlers = {\n\t\t\tgetSetting,\n\t\t\tsetSetting\n\t\t};\n\t\treturn this;\n\t}\n\t/**\n\t* Add a setting row with label and form control.\n\t* @param label Label text for the setting\n\t* @param settingKey The key used to store/retrieve the setting\n\t* @param controlProps Properties for the form control element\n\t* @param options Additional options\n\t* @param options.valueType Type of the setting value for proper conversion\n\t* @param options.labelProps Properties for the label element\n\t* @param options.condition Optional condition function to determine if the setting should be added\n\t*                          (returns true to add, false to skip)\n\t* @returns The SettingsDialogHelper instance for chaining\n\t*/\n\taddSetting(label, settingKey, controlProps, options = {}) {\n\t\tconst { valueType = \"string\", labelProps = {}, condition } = options;\n\t\tif (condition && !condition()) return this;\n\t\tconst controlId = CSS.escape(`setting-${settingKey}-${Zotero.Utilities.randomString()}`);\n\t\tthis.settingBindings.set(controlId, {\n\t\t\tkey: settingKey,\n\t\t\tvalueType\n\t\t});\n\t\tconst gridContainer = this.elementProps.children[0];\n\t\tconst labelElement = {\n\t\t\ttag: \"label\",\n\t\t\tattributes: { for: controlId },\n\t\t\tproperties: { textContent: label },\n\t\t\tstyles: {\n\t\t\t\tfontWeight: \"500\",\n\t\t\t\ttextAlign: \"right\",\n\t\t\t\tpaddingRight: \"10px\"\n\t\t\t},\n\t\t\t...labelProps\n\t\t};\n\t\tconst controlElement = {\n\t\t\t...controlProps,\n\t\t\tid: controlId,\n\t\t\tattributes: {\n\t\t\t\t...controlProps.attributes,\n\t\t\t\t\"data-setting-key\": settingKey,\n\t\t\t\t\"data-setting-type\": valueType\n\t\t\t}\n\t\t};\n\t\tif (this.settingsHandlers) {\n\t\t\tconst currentValue = this.settingsHandlers.getSetting(settingKey);\n\t\t\tthis.setControlValue(controlElement, currentValue, valueType);\n\t\t}\n\t\tgridContainer.children.push(labelElement, controlElement);\n\t\treturn this;\n\t}\n\t/**\n\t* Add a static row (label + static element) to the settings grid. This is not a form control.\n\t* @param label Label text for the row\n\t* @param staticElementProps Properties for the static element (e.g., text, icon, etc.)\n\t* @param options Additional options\n\t* @param options.labelProps Properties for the label element\n\t* @param options.condition Optional condition function to determine if the row should be added\n\t* @returns The SettingsDialogHelper instance for chaining\n\t*/\n\taddStaticRow(label, staticElementProps, options = {}) {\n\t\tconst { labelProps = {}, condition } = options;\n\t\tif (condition && !condition()) return this;\n\t\tconst gridContainer = this.elementProps.children[0];\n\t\tconst labelElement = {\n\t\t\ttag: \"label\",\n\t\t\tproperties: { textContent: label },\n\t\t\tstyles: {\n\t\t\t\tfontWeight: \"500\",\n\t\t\t\ttextAlign: \"right\",\n\t\t\t\tpaddingRight: \"10px\"\n\t\t\t},\n\t\t\t...labelProps\n\t\t};\n\t\tconst staticElement = {\n\t\t\t...staticElementProps,\n\t\t\tattributes: { ...staticElementProps.attributes }\n\t\t};\n\t\tgridContainer.children.push(labelElement, staticElement);\n\t\treturn this;\n\t}\n\t/**\n\t* Add a control button that will auto-save settings when clicked.\n\t* @param label Button label\n\t* @param id Button id\n\t* @param options Button options\n\t* @param options.noClose Don't close window when clicking this button\n\t* @param options.validate Validation function for settings data\n\t* @param options.callback Callback of button click event\n\t*/\n\taddAutoSaveButton(label, id, options = {}) {\n\t\tid = id || `btn-${Zotero.Utilities.randomString()}-${(/* @__PURE__ */ new Date()).getTime()}`;\n\t\tthis.autoSaveButtonIds.add(id);\n\t\treturn this.addButton(label, id, {\n\t\t\t...Object.assign({}, options, { noClose: true }),\n\t\t\tcallback: async (ev) => {\n\t\t\t\tif (options.validate) {\n\t\t\t\t\tconst data = this.getAllSettingsData();\n\t\t\t\t\tconst validationResult = await options.validate(data);\n\t\t\t\t\tif (validationResult !== true) {\n\t\t\t\t\t\tthis.window.alert(validationResult);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.saveAllSettings();\n\t\t\t\tif (options.callback) options.callback(ev);\n\t\t\t\tif (!options.noClose) this.window.close();\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t* Save all settings using the setting handlers.\n\t*/\n\tsaveAllSettings() {\n\t\tif (!this.settingsHandlers) {\n\t\t\tconsole.warn(\"SettingsDialog: No setting handlers configured\");\n\t\t\treturn;\n\t\t}\n\t\tconst settingsData = this.getAllSettingsData();\n\t\tObject.entries(settingsData).forEach(([key, value]) => {\n\t\t\tthis.settingsHandlers.setSetting(key, value);\n\t\t});\n\t}\n\t/**\n\t* Collect and return all current setting values from the dialog controls.\n\t*/\n\tgetAllSettingsData() {\n\t\tconst data = {};\n\t\tif (this.window) {\n\t\t\tconst settingControls = this.window.document.querySelectorAll(\"[data-setting-key]\");\n\t\t\tsettingControls.forEach((control) => {\n\t\t\t\tconst settingKey = control.getAttribute(\"data-setting-key\");\n\t\t\t\tconst valueType = control.getAttribute(\"data-setting-type\");\n\t\t\t\tif (settingKey) data[settingKey] = this.getControlValue(control, valueType);\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\t/**\n\t* Load all settings from the setting handlers.\n\t*/\n\tloadAllSettings() {\n\t\tif (!this.settingsHandlers || !this.window) return;\n\t\tconst settingControls = this.window.document.querySelectorAll(\"[data-setting-key]\");\n\t\tsettingControls.forEach((control) => {\n\t\t\tconst settingKey = control.getAttribute(\"data-setting-key\");\n\t\t\tconst valueType = control.getAttribute(\"data-setting-type\");\n\t\t\tif (settingKey) {\n\t\t\t\tconst value = this.settingsHandlers.getSetting(settingKey);\n\t\t\t\tthis.setControlValueOnElement(control, value, valueType);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t* Override the open method to handle setting loading after window opens.\n\t*/\n\topen(title, windowFeatures = {\n\t\tcenterscreen: true,\n\t\tresizable: true,\n\t\tfitContent: true\n\t}) {\n\t\tconst originalLoadCallback = this.dialogData.loadCallback;\n\t\tthis.dialogData.loadCallback = () => {\n\t\t\tthis.loadAllSettings();\n\t\t\tthis.window.document.body.style.overflow = \"hidden\";\n\t\t\tif (windowFeatures.fitContent) this.window.sizeToContent();\n\t\t\tif (originalLoadCallback) originalLoadCallback();\n\t\t};\n\t\tconst originalBeforeUnloadCallback = this.dialogData.beforeUnloadCallback;\n\t\tthis.dialogData.beforeUnloadCallback = () => {\n\t\t\tif (this.dialogData._lastButtonId && this.autoSaveButtonIds.has(this.dialogData._lastButtonId)) this.saveAllSettings();\n\t\t\tif (originalBeforeUnloadCallback) originalBeforeUnloadCallback();\n\t\t};\n\t\treturn super.open(title, windowFeatures);\n\t}\n\t/**\n\t* Set control value based on element type and value type.\n\t*/\n\tsetControlValue(element, value, _valueType) {\n\t\tif (value === void 0 || value === null) return;\n\t\tswitch (element.tag) {\n\t\t\tcase \"input\": {\n\t\t\t\tconst inputType = element.attributes?.type || \"text\";\n\t\t\t\tif (inputType === \"checkbox\" || inputType === \"radio\") element.attributes = {\n\t\t\t\t\t...element.attributes,\n\t\t\t\t\tchecked: Boolean(value)\n\t\t\t\t};\n\t\t\t\telse element.attributes = {\n\t\t\t\t\t...element.attributes,\n\t\t\t\t\tvalue: String(value)\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"select\":\n\t\t\t\telement.attributes = {\n\t\t\t\t\t...element.attributes,\n\t\t\t\t\tvalue: String(value)\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"textarea\":\n\t\t\t\telement.properties = {\n\t\t\t\t\t...element.properties,\n\t\t\t\t\tvalue: String(value)\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tdefault: element.properties = {\n\t\t\t\t...element.properties,\n\t\t\t\ttextContent: String(value)\n\t\t\t};\n\t\t}\n\t}\n\t/**\n\t* Set control value on an actual DOM element.\n\t*/\n\tsetControlValueOnElement(element, value, _valueType) {\n\t\tif (value === void 0 || value === null) return;\n\t\tconst tagName = element.tagName.toLowerCase();\n\t\tswitch (tagName) {\n\t\t\tcase \"input\": {\n\t\t\t\tconst inputElement = element;\n\t\t\t\tif (inputElement.type === \"checkbox\" || inputElement.type === \"radio\") inputElement.checked = Boolean(value);\n\t\t\t\telse inputElement.value = String(value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"select\":\n\t\t\t\telement.value = String(value);\n\t\t\t\tbreak;\n\t\t\tcase \"textarea\":\n\t\t\t\telement.value = String(value);\n\t\t\t\tbreak;\n\t\t\tdefault: element.textContent = String(value);\n\t\t}\n\t}\n\t/**\n\t* Get control value from a DOM element with proper type conversion.\n\t*/\n\tgetControlValue(element, valueType) {\n\t\tconst tagName = element.tagName.toLowerCase();\n\t\tlet rawValue;\n\t\tswitch (tagName) {\n\t\t\tcase \"input\": {\n\t\t\t\tconst inputElement = element;\n\t\t\t\tif (inputElement.type === \"checkbox\" || inputElement.type === \"radio\") rawValue = inputElement.checked;\n\t\t\t\telse rawValue = inputElement.value;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"select\":\n\t\t\t\trawValue = element.value;\n\t\t\t\tbreak;\n\t\t\tcase \"textarea\":\n\t\t\t\trawValue = element.value;\n\t\t\t\tbreak;\n\t\t\tdefault: rawValue = element.textContent || \"\";\n\t\t}\n\t\tswitch (valueType) {\n\t\t\tcase \"number\": return typeof rawValue === \"string\" ? Number(rawValue) : rawValue;\n\t\t\tcase \"boolean\": return typeof rawValue === \"boolean\" ? rawValue : Boolean(rawValue);\n\t\t\tcase \"string\":\n\t\t\tdefault: return String(rawValue);\n\t\t}\n\t}\n};\n\n//#endregion\n//#region src/helpers/virtualizedTable.ts\n/**\n* VirtualizedTable helper.\n*/\nvar VirtualizedTableHelper = class extends BasicTool {\n\tprops;\n\tlocaleStrings;\n\tcontainerId;\n\ttreeInstance;\n\twindow;\n\tReact;\n\tReactDOM;\n\tVirtualizedTable;\n\tIntlProvider;\n\tconstructor(win) {\n\t\tsuper();\n\t\tthis.window = win;\n\t\tconst Zotero$1 = this.getGlobal(\"Zotero\");\n\t\tconst _require = win.require;\n\t\tthis.React = _require(\"react\");\n\t\tthis.ReactDOM = _require(\"react-dom\");\n\t\tthis.VirtualizedTable = _require(\"components/virtualized-table\");\n\t\tthis.IntlProvider = _require(\"react-intl\").IntlProvider;\n\t\tthis.props = {\n\t\t\tid: `vtable-${Zotero$1.Utilities.randomString()}-${(/* @__PURE__ */ new Date()).getTime()}`,\n\t\t\tgetRowCount: () => 0\n\t\t};\n\t\tthis.localeStrings = Zotero$1.Intl.strings;\n\t}\n\tsetProp(...args) {\n\t\tif (args.length === 1) Object.assign(this.props, args[0]);\n\t\telse if (args.length === 2) this.props[args[0]] = args[1];\n\t\treturn this;\n\t}\n\t/**\n\t* Set locale strings, which replaces the table header's label if matches. Default it's `Zotero.Intl.strings`\n\t* @param localeStrings\n\t*/\n\tsetLocale(localeStrings) {\n\t\tObject.assign(this.localeStrings, localeStrings);\n\t\treturn this;\n\t}\n\t/**\n\t* Set container element id that the table will be rendered on.\n\t* @param id element id\n\t*/\n\tsetContainerId(id) {\n\t\tthis.containerId = id;\n\t\treturn this;\n\t}\n\t/**\n\t* Render the table.\n\t* @param selectId Which row to select after rendering\n\t* @param onfulfilled callback after successfully rendered\n\t* @param onrejected callback after rendering with error\n\t*/\n\trender(selectId, onfulfilled, onrejected) {\n\t\tconst refreshSelection = () => {\n\t\t\tthis.treeInstance.invalidate();\n\t\t\tif (typeof selectId !== \"undefined\" && selectId >= 0) this.treeInstance.selection.select(selectId);\n\t\t\telse this.treeInstance.selection.clearSelection();\n\t\t};\n\t\tif (!this.treeInstance) new Promise((resolve) => {\n\t\t\tconst vtableProps = Object.assign({}, this.props, { ref: (ref) => {\n\t\t\t\tthis.treeInstance = ref;\n\t\t\t\tresolve(void 0);\n\t\t\t} });\n\t\t\tif (vtableProps.getRowData && !vtableProps.renderItem) Object.assign(vtableProps, { renderItem: this.VirtualizedTable.makeRowRenderer(vtableProps.getRowData) });\n\t\t\tconst elem = this.React.createElement(this.IntlProvider, {\n\t\t\t\tlocale: Zotero.locale,\n\t\t\t\tmessages: Zotero.Intl.strings\n\t\t\t}, this.React.createElement(this.VirtualizedTable, vtableProps));\n\t\t\tconst container = this.window.document.getElementById(this.containerId);\n\t\t\tthis.ReactDOM.createRoot(container).render(elem);\n\t\t}).then(() => {\n\t\t\tthis.getGlobal(\"setTimeout\")(() => {\n\t\t\t\trefreshSelection();\n\t\t\t});\n\t\t}).then(onfulfilled, onrejected);\n\t\telse refreshSelection();\n\t\treturn this;\n\t}\n};\n\n//#endregion\n//#region src/managers/fieldHook.ts\n/**\n* Item field hooks manager.\n*/\nvar FieldHookManager = class extends ManagerTool {\n\tdata = {\n\t\tgetField: {},\n\t\tsetField: {},\n\t\tisFieldOfBase: {}\n\t};\n\tpatchHelpers = {\n\t\tgetField: new PatchHelper(),\n\t\tsetField: new PatchHelper(),\n\t\tisFieldOfBase: new PatchHelper()\n\t};\n\tconstructor(base) {\n\t\tsuper(base);\n\t\tconst _thisHelper = this;\n\t\tfor (const type of Object.keys(this.patchHelpers)) {\n\t\t\tconst helper = this.patchHelpers[type];\n\t\t\thelper.setData({\n\t\t\t\ttarget: this.getGlobal(\"Zotero\").Item.prototype,\n\t\t\t\tfuncSign: type,\n\t\t\t\tpatcher: (original) => function(field, ...args) {\n\t\t\t\t\tconst originalThis = this;\n\t\t\t\t\tconst handler = _thisHelper.data[type][field];\n\t\t\t\t\tif (typeof handler === \"function\") try {\n\t\t\t\t\t\treturn handler(field, args[0], args[1], originalThis, original);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn field + String(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn original.apply(originalThis, [field, ...args]);\n\t\t\t\t},\n\t\t\t\tenabled: true\n\t\t\t});\n\t\t}\n\t}\n\tregister(type, field, hook) {\n\t\tthis.data[type][field] = hook;\n\t}\n\tunregister(type, field) {\n\t\tdelete this.data[type][field];\n\t}\n\tunregisterAll() {\n\t\tthis.data.getField = {};\n\t\tthis.data.setField = {};\n\t\tthis.data.isFieldOfBase = {};\n\t\tthis.patchHelpers.getField.disable();\n\t\tthis.patchHelpers.setField.disable();\n\t\tthis.patchHelpers.isFieldOfBase.disable();\n\t}\n};\n\n//#endregion\n//#region src/utils/wait.ts\nvar wait_exports = {};\n__export(wait_exports, {\n\twaitForReader: () => waitForReader,\n\twaitUntil: () => waitUntil,\n\twaitUntilAsync: () => waitUntilAsync,\n\twaitUtilAsync: () => waitUtilAsync\n});\nconst basicTool = new BasicTool();\nfunction waitUntil(condition, callback, interval = 100, timeout = 1e4) {\n\tconst start = Date.now();\n\tconst intervalId = basicTool.getGlobal(\"setInterval\")(() => {\n\t\tif (condition()) {\n\t\t\tbasicTool.getGlobal(\"clearInterval\")(intervalId);\n\t\t\tcallback();\n\t\t} else if (Date.now() - start > timeout) basicTool.getGlobal(\"clearInterval\")(intervalId);\n\t}, interval);\n}\nconst waitUtilAsync = waitUntilAsync;\nfunction waitUntilAsync(condition, interval = 100, timeout = 1e4) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst start = Date.now();\n\t\tconst intervalId = basicTool.getGlobal(\"setInterval\")(() => {\n\t\t\tif (condition()) {\n\t\t\t\tbasicTool.getGlobal(\"clearInterval\")(intervalId);\n\t\t\t\tresolve();\n\t\t\t} else if (Date.now() - start > timeout) {\n\t\t\t\tbasicTool.getGlobal(\"clearInterval\")(intervalId);\n\t\t\t\treject(/* @__PURE__ */ new Error(\"timeout\"));\n\t\t\t}\n\t\t}, interval);\n\t});\n}\nasync function waitForReader(reader) {\n\tawait reader._initPromise;\n\tawait reader._lastView.initializedPromise;\n\tif (reader.type === \"pdf\") await reader._lastView._iframeWindow.PDFViewerApplication.initializedPromise;\n}\n\n//#endregion\n//#region src/managers/keyboard.ts\n/**\n* Register a global keyboard event listener.\n*/\nvar KeyboardManager = class extends ManagerTool {\n\t_keyboardCallbacks = /* @__PURE__ */ new Set();\n\t_cachedKey;\n\tid;\n\tconstructor(base) {\n\t\tsuper(base);\n\t\tthis.id = `kbd-${Zotero.Utilities.randomString()}`;\n\t\tthis._ensureAutoUnregisterAll();\n\t\tthis.addListenerCallback(\"onMainWindowLoad\", this.initKeyboardListener);\n\t\tthis.addListenerCallback(\"onMainWindowUnload\", this.unInitKeyboardListener);\n\t\tthis.initReaderKeyboardListener();\n\t\tfor (const win of Zotero.getMainWindows()) this.initKeyboardListener(win);\n\t}\n\t/**\n\t* Register a keyboard event listener.\n\t* @param callback The callback function.\n\t*/\n\tregister(callback) {\n\t\tthis._keyboardCallbacks.add(callback);\n\t}\n\t/**\n\t* Unregister a keyboard event listener.\n\t* @param callback The callback function.\n\t*/\n\tunregister(callback) {\n\t\tthis._keyboardCallbacks.delete(callback);\n\t}\n\t/**\n\t* Unregister all keyboard event listeners.\n\t*/\n\tunregisterAll() {\n\t\tthis._keyboardCallbacks.clear();\n\t\tthis.removeListenerCallback(\"onMainWindowLoad\", this.initKeyboardListener);\n\t\tthis.removeListenerCallback(\"onMainWindowUnload\", this.unInitKeyboardListener);\n\t\tfor (const win of Zotero.getMainWindows()) this.unInitKeyboardListener(win);\n\t}\n\tinitKeyboardListener = this._initKeyboardListener.bind(this);\n\tunInitKeyboardListener = this._unInitKeyboardListener.bind(this);\n\tinitReaderKeyboardListener() {\n\t\tZotero.Reader.registerEventListener(\"renderToolbar\", (event) => this.addReaderKeyboardCallback(event), this._basicOptions.api.pluginID);\n\t\tZotero.Reader._readers.forEach((reader) => this.addReaderKeyboardCallback({ reader }));\n\t}\n\tasync addReaderKeyboardCallback(event) {\n\t\tconst reader = event.reader;\n\t\tconst initializedKey = `_ztoolkitKeyboard${this.id}Initialized`;\n\t\tawait waitForReader(reader);\n\t\tif (!reader._iframeWindow) return;\n\t\tif (reader._iframeWindow[initializedKey]) return;\n\t\tthis._initKeyboardListener(reader._iframeWindow);\n\t\twaitUntil(() => !Components.utils.isDeadWrapper(reader._internalReader) && (reader._internalReader?._primaryView)?._iframeWindow, () => this._initKeyboardListener(reader._internalReader._primaryView?._iframeWindow));\n\t\treader._iframeWindow[initializedKey] = true;\n\t}\n\t_initKeyboardListener(win) {\n\t\tif (!win) return;\n\t\twin.addEventListener(\"keydown\", this.triggerKeydown);\n\t\twin.addEventListener(\"keyup\", this.triggerKeyup);\n\t}\n\t_unInitKeyboardListener(win) {\n\t\tif (!win) return;\n\t\twin.removeEventListener(\"keydown\", this.triggerKeydown);\n\t\twin.removeEventListener(\"keyup\", this.triggerKeyup);\n\t}\n\ttriggerKeydown = (e) => {\n\t\tif (!this._cachedKey) this._cachedKey = new KeyModifier(e);\n\t\telse this._cachedKey.merge(new KeyModifier(e), { allowOverwrite: false });\n\t\tthis.dispatchCallback(e, { type: \"keydown\" });\n\t};\n\ttriggerKeyup = async (e) => {\n\t\tif (!this._cachedKey) return;\n\t\tconst currentShortcut = new KeyModifier(this._cachedKey);\n\t\tthis._cachedKey = void 0;\n\t\tthis.dispatchCallback(e, {\n\t\t\tkeyboard: currentShortcut,\n\t\t\ttype: \"keyup\"\n\t\t});\n\t};\n\tdispatchCallback(...args) {\n\t\tthis._keyboardCallbacks.forEach((cbk) => cbk(...args));\n\t}\n};\n/**\n* Class to represent key with modifiers\n*/\nvar KeyModifier = class KeyModifier {\n\taccel = false;\n\tshift = false;\n\tcontrol = false;\n\tmeta = false;\n\talt = false;\n\tkey = \"\";\n\tuseAccel = false;\n\tconstructor(raw, options) {\n\t\tthis.useAccel = options?.useAccel || false;\n\t\tif (typeof raw === \"undefined\") {} else if (typeof raw === \"string\") {\n\t\t\traw = raw || \"\";\n\t\t\traw = this.unLocalized(raw);\n\t\t\tthis.accel = raw.includes(\"accel\");\n\t\t\tthis.shift = raw.includes(\"shift\");\n\t\t\tthis.control = raw.includes(\"control\");\n\t\t\tthis.meta = raw.includes(\"meta\");\n\t\t\tthis.alt = raw.includes(\"alt\");\n\t\t\tthis.key = raw.replace(/(accel|shift|control|meta|alt|[ ,\\-])/g, \"\").toLocaleLowerCase();\n\t\t\tif (!this.key && (raw.includes(\",,\") || raw === \",\")) this.key = \",\";\n\t\t} else if (raw instanceof KeyModifier) this.merge(raw, { allowOverwrite: true });\n\t\telse {\n\t\t\tif (options?.useAccel) if (Zotero.isMac) this.accel = raw.metaKey;\n\t\t\telse this.accel = raw.ctrlKey;\n\t\t\tthis.shift = raw.shiftKey;\n\t\t\tthis.control = raw.ctrlKey;\n\t\t\tthis.meta = raw.metaKey;\n\t\t\tthis.alt = raw.altKey;\n\t\t\tif (![\n\t\t\t\t\"Shift\",\n\t\t\t\t\"Meta\",\n\t\t\t\t\"Ctrl\",\n\t\t\t\t\"Alt\",\n\t\t\t\t\"Control\"\n\t\t\t].includes(raw.key)) this.key = raw.key;\n\t\t}\n\t}\n\t/**\n\t* Merge another KeyModifier into this one.\n\t* @param newMod the new KeyModifier\n\t* @param options\n\t* @param options.allowOverwrite\n\t* @returns KeyModifier\n\t*/\n\tmerge(newMod, options) {\n\t\tconst allowOverwrite = options?.allowOverwrite || false;\n\t\tthis.mergeAttribute(\"accel\", newMod.accel, allowOverwrite);\n\t\tthis.mergeAttribute(\"shift\", newMod.shift, allowOverwrite);\n\t\tthis.mergeAttribute(\"control\", newMod.control, allowOverwrite);\n\t\tthis.mergeAttribute(\"meta\", newMod.meta, allowOverwrite);\n\t\tthis.mergeAttribute(\"alt\", newMod.alt, allowOverwrite);\n\t\tthis.mergeAttribute(\"key\", newMod.key, allowOverwrite);\n\t\treturn this;\n\t}\n\t/**\n\t* Check if the current KeyModifier equals to another KeyModifier.\n\t* @param newMod the new KeyModifier\n\t* @returns true if equals\n\t*/\n\tequals(newMod) {\n\t\tif (typeof newMod === \"string\") newMod = new KeyModifier(newMod);\n\t\tif (this.shift !== newMod.shift || this.alt !== newMod.alt || this.key.toLowerCase() !== newMod.key.toLowerCase()) return false;\n\t\tif (this.accel || newMod.accel) {\n\t\t\tif (Zotero.isMac) {\n\t\t\t\tif ((this.accel || this.meta) !== (newMod.accel || newMod.meta) || this.control !== newMod.control) return false;\n\t\t\t} else if ((this.accel || this.control) !== (newMod.accel || newMod.control) || this.meta !== newMod.meta) return false;\n\t\t} else if (this.control !== newMod.control || this.meta !== newMod.meta) return false;\n\t\treturn true;\n\t}\n\t/**\n\t* Get the raw string representation of the KeyModifier.\n\t*/\n\tgetRaw() {\n\t\tconst enabled = [];\n\t\tthis.accel && enabled.push(\"accel\");\n\t\tthis.shift && enabled.push(\"shift\");\n\t\tthis.control && enabled.push(\"control\");\n\t\tthis.meta && enabled.push(\"meta\");\n\t\tthis.alt && enabled.push(\"alt\");\n\t\tthis.key && enabled.push(this.key);\n\t\treturn enabled.join(\",\");\n\t}\n\t/**\n\t* Get the localized string representation of the KeyModifier.\n\t*/\n\tgetLocalized() {\n\t\tconst raw = this.getRaw();\n\t\tif (Zotero.isMac) return raw.replaceAll(\"control\", \"\u2303\").replaceAll(\"alt\", \"\u2325\").replaceAll(\"shift\", \"\u21E7\").replaceAll(\"meta\", \"\u2318\");\n\t\telse return raw.replaceAll(\"control\", \"Ctrl\").replaceAll(\"alt\", \"Alt\").replaceAll(\"shift\", \"Shift\").replaceAll(\"meta\", \"Win\");\n\t}\n\t/**\n\t* Get the un-localized string representation of the KeyModifier.\n\t*/\n\tunLocalized(raw) {\n\t\tif (Zotero.isMac) return raw.replaceAll(\"\u2303\", \"control\").replaceAll(\"\u2325\", \"alt\").replaceAll(\"\u21E7\", \"shift\").replaceAll(\"\u2318\", \"meta\");\n\t\telse return raw.replaceAll(\"Ctrl\", \"control\").replaceAll(\"Alt\", \"alt\").replaceAll(\"Shift\", \"shift\").replaceAll(\"Win\", \"meta\");\n\t}\n\tmergeAttribute(attribute, value, allowOverwrite) {\n\t\tif (allowOverwrite || !this[attribute]) this[attribute] = value;\n\t}\n};\n\n//#endregion\n//#region src/managers/menu.ts\n/**\n* Register \\<menuitem\\>, \\<menupopup\\>, or \\<menuseperator\\> to Zotero right-click/window menus.\n* @deprecated Use `Zotero.MenuManager` instead. This API is planned to be removed in 6 months after Zotero 8 is officially released.\n*/\nvar MenuManager = class extends ManagerTool {\n\tui;\n\tconstructor(base) {\n\t\tsuper(base);\n\t\tthis.ui = new UITool(this);\n\t}\n\t/**\n\t* Insert an menu item/menu(with popup)/menuseprator into a menupopup\n\t* @remarks\n\t* options:\n\t* ```ts\n\t* export interface MenuitemOptions {\n\t*   tag: \"menuitem\" | \"menu\" | \"menuseparator\";\n\t*   id?: string;\n\t*   label?: string;\n\t*   // data url (chrome://xxx.png) or base64 url (data:image/png;base64,xxx)\n\t*   icon?: string;\n\t*   class?: string;\n\t*   styles?: { [key: string]: string };\n\t*   hidden?: boolean;\n\t*   disabled?: boolean;\n\t*   oncommand?: string;\n\t*   commandListener?: EventListenerOrEventListenerObject;\n\t*   // Attributes below are used when type === \"menu\"\n\t*   popupId?: string;\n\t*   onpopupshowing?: string;\n\t*   subElementOptions?: Array<MenuitemOptions>;\n\t* }\n\t* ```\n\t* @param menuPopup\n\t* @param options\n\t* @param insertPosition\n\t* @param anchorElement The menuitem will be put before/after `anchorElement`. If not set, put at start/end of the menupopup.\n\t* @example\n\t* Insert menuitem with icon into item menupopup\n\t* ```ts\n\t* // base64 or chrome:// url\n\t* const menuIcon = \"chrome://addontemplate/content/icons/favicon@0.5x.png\";\n\t* ztoolkit.Menu.register(\"item\", {\n\t*   tag: \"menuitem\",\n\t*   id: \"zotero-itemmenu-addontemplate-test\",\n\t*   label: \"Addon Template: Menuitem\",\n\t*   oncommand: \"alert('Hello World! Default Menuitem.')\",\n\t*   icon: menuIcon,\n\t* });\n\t* ```\n\t* @example\n\t* Insert menu into file menupopup\n\t* ```ts\n\t* ztoolkit.Menu.register(\n\t*   \"menuFile\",\n\t*   {\n\t*     tag: \"menu\",\n\t*     label: \"Addon Template: Menupopup\",\n\t*     subElementOptions: [\n\t*       {\n\t*         tag: \"menuitem\",\n\t*         label: \"Addon Template\",\n\t*         oncommand: \"alert('Hello World! Sub Menuitem.')\",\n\t*       },\n\t*     ],\n\t*   },\n\t*   \"before\",\n\t*   Zotero.getMainWindow().document.querySelector(\n\t*     \"#zotero-itemmenu-addontemplate-test\"\n\t*   )\n\t* );\n\t* ```\n\t*/\n\tregister(menuPopup, options, insertPosition = \"after\", anchorElement) {\n\t\tlet popup;\n\t\tif (typeof menuPopup === \"string\") popup = this.getGlobal(\"document\").querySelector(MenuSelector[menuPopup]);\n\t\telse popup = menuPopup;\n\t\tif (!popup) return false;\n\t\tconst doc = popup.ownerDocument;\n\t\tconst genMenuElement = (menuitemOption) => {\n\t\t\tconst elementOption = {\n\t\t\t\ttag: menuitemOption.tag,\n\t\t\t\tid: menuitemOption.id,\n\t\t\t\tnamespace: \"xul\",\n\t\t\t\tattributes: {\n\t\t\t\t\tlabel: menuitemOption.label || \"\",\n\t\t\t\t\thidden: Boolean(menuitemOption.hidden),\n\t\t\t\t\tdisabled: Boolean(menuitemOption.disabled),\n\t\t\t\t\tclass: menuitemOption.class || \"\",\n\t\t\t\t\toncommand: menuitemOption.oncommand || \"\"\n\t\t\t\t},\n\t\t\t\tclassList: menuitemOption.classList,\n\t\t\t\tstyles: menuitemOption.styles || {},\n\t\t\t\tlisteners: [],\n\t\t\t\tchildren: []\n\t\t\t};\n\t\t\tif (menuitemOption.icon) {\n\t\t\t\tif (!this.getGlobal(\"Zotero\").isMac) if (menuitemOption.tag === \"menu\") elementOption.attributes.class += \" menu-iconic\";\n\t\t\t\telse elementOption.attributes.class += \" menuitem-iconic\";\n\t\t\t\telementOption.styles[\"list-style-image\"] = `url(${menuitemOption.icon})`;\n\t\t\t}\n\t\t\tif (menuitemOption.commandListener) elementOption.listeners?.push({\n\t\t\t\ttype: \"command\",\n\t\t\t\tlistener: menuitemOption.commandListener\n\t\t\t});\n\t\t\tif (menuitemOption.tag === \"menuitem\") {\n\t\t\t\telementOption.attributes.type = menuitemOption.type || \"\";\n\t\t\t\telementOption.attributes.checked = menuitemOption.checked || false;\n\t\t\t}\n\t\t\tconst menuItem = this.ui.createElement(doc, menuitemOption.tag, elementOption);\n\t\t\tif (menuitemOption.isHidden || menuitemOption.getVisibility) popup?.addEventListener(\"popupshowing\", async (ev) => {\n\t\t\t\tlet hidden;\n\t\t\t\tif (menuitemOption.isHidden) hidden = await menuitemOption.isHidden(menuItem, ev);\n\t\t\t\telse if (menuitemOption.getVisibility) {\n\t\t\t\t\tconst visible = await menuitemOption.getVisibility(menuItem, ev);\n\t\t\t\t\thidden = typeof visible === \"undefined\" ? void 0 : !visible;\n\t\t\t\t}\n\t\t\t\tif (typeof hidden === \"undefined\") return;\n\t\t\t\tif (hidden) menuItem.setAttribute(\"hidden\", \"true\");\n\t\t\t\telse menuItem.removeAttribute(\"hidden\");\n\t\t\t});\n\t\t\tif (menuitemOption.isDisabled) popup?.addEventListener(\"popupshowing\", async (ev) => {\n\t\t\t\tconst disabled = await menuitemOption.isDisabled(menuItem, ev);\n\t\t\t\tif (typeof disabled === \"undefined\") return;\n\t\t\t\tif (disabled) menuItem.setAttribute(\"disabled\", \"true\");\n\t\t\t\telse menuItem.removeAttribute(\"disabled\");\n\t\t\t});\n\t\t\tif ((menuitemOption.tag === \"menuitem\" || menuitemOption.tag === \"menuseparator\") && menuitemOption.onShowing) popup?.addEventListener(\"popupshowing\", async (ev) => {\n\t\t\t\tawait menuitemOption.onShowing(menuItem, ev);\n\t\t\t});\n\t\t\tif (menuitemOption.tag === \"menu\") {\n\t\t\t\tconst subPopup = this.ui.createElement(doc, \"menupopup\", {\n\t\t\t\t\tid: menuitemOption.popupId,\n\t\t\t\t\tattributes: { onpopupshowing: menuitemOption.onpopupshowing || \"\" }\n\t\t\t\t});\n\t\t\t\tmenuitemOption.children?.forEach((childOption) => {\n\t\t\t\t\tsubPopup.append(genMenuElement(childOption));\n\t\t\t\t});\n\t\t\t\tmenuItem.append(subPopup);\n\t\t\t}\n\t\t\treturn menuItem;\n\t\t};\n\t\tconst topMenuItem = genMenuElement(options);\n\t\tif (popup.childElementCount) {\n\t\t\tif (!anchorElement) anchorElement = insertPosition === \"after\" ? popup.lastElementChild : popup.firstElementChild;\n\t\t\tanchorElement[insertPosition](topMenuItem);\n\t\t} else popup.appendChild(topMenuItem);\n\t}\n\tunregister(menuId) {\n\t\tthis.getGlobal(\"document\").querySelector(`#${menuId}`)?.remove();\n\t}\n\tunregisterAll() {\n\t\tthis.ui.unregisterAll();\n\t}\n};\nvar MenuSelector = /* @__PURE__ */ function(MenuSelector$1) {\n\tMenuSelector$1[\"menuFile\"] = \"#menu_FilePopup\";\n\tMenuSelector$1[\"menuEdit\"] = \"#menu_EditPopup\";\n\tMenuSelector$1[\"menuView\"] = \"#menu_viewPopup\";\n\tMenuSelector$1[\"menuGo\"] = \"#menu_goPopup\";\n\tMenuSelector$1[\"menuTools\"] = \"#menu_ToolsPopup\";\n\tMenuSelector$1[\"menuHelp\"] = \"#menu_HelpPopup\";\n\tMenuSelector$1[\"collection\"] = \"#zotero-collectionmenu\";\n\tMenuSelector$1[\"item\"] = \"#zotero-itemmenu\";\n\treturn MenuSelector$1;\n}(MenuSelector || {});\n\n//#endregion\n//#region src/managers/prompt.ts\n/**\n* Prompt for setting up or executing some commands quickly.\n*\n* `Shift + P` can show/hide its UI anywhere after registering commands.\n*/\nvar Prompt = class {\n\tui;\n\tbase;\n\tget document() {\n\t\treturn this.base.getGlobal(\"document\");\n\t}\n\t/**\n\t* Record the last text entered\n\t*/\n\tlastInputText = \"\";\n\t/**\n\t* Default text\n\t*/\n\tdefaultText = {\n\t\tplaceholder: \"Select a command...\",\n\t\tempty: \"No commands found.\"\n\t};\n\t/**\n\t* It controls the max line number of commands displayed in `commandsNode`.\n\t*/\n\tmaxLineNum = 12;\n\t/**\n\t* It controls the max number of suggestions.\n\t*/\n\tmaxSuggestionNum = 100;\n\t/**\n\t* The top-level HTML div node of `Prompt`\n\t*/\n\tpromptNode;\n\t/**\n\t* The HTML input node of `Prompt`.\n\t*/\n\tinputNode;\n\t/**\n\t* Save all commands registered by all addons.\n\t*/\n\tcommands = [];\n\t/**\n\t* Initialize `Prompt` but do not create UI.\n\t*/\n\tconstructor() {\n\t\tthis.base = new BasicTool();\n\t\tthis.ui = new UITool();\n\t\tthis.initializeUI();\n\t}\n\t/**\n\t* Initialize `Prompt` UI and then bind events on it.\n\t*/\n\tinitializeUI() {\n\t\tthis.addStyle();\n\t\tthis.createHTML();\n\t\tthis.initInputEvents();\n\t\tthis.registerShortcut();\n\t}\n\tcreateHTML() {\n\t\tthis.promptNode = this.ui.createElement(this.document, \"div\", {\n\t\t\tstyles: { display: \"none\" },\n\t\t\tchildren: [{\n\t\t\t\ttag: \"div\",\n\t\t\t\tstyles: {\n\t\t\t\t\tposition: \"fixed\",\n\t\t\t\t\tleft: \"0\",\n\t\t\t\t\ttop: \"0\",\n\t\t\t\t\tbackgroundColor: \"transparent\",\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\theight: \"100%\"\n\t\t\t\t},\n\t\t\t\tlisteners: [{\n\t\t\t\t\ttype: \"click\",\n\t\t\t\t\tlistener: () => {\n\t\t\t\t\t\tthis.promptNode.style.display = \"none\";\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t});\n\t\tthis.promptNode.appendChild(this.ui.createElement(this.document, \"div\", {\n\t\t\tid: `zotero-plugin-toolkit-prompt`,\n\t\t\tclassList: [\"prompt-container\"],\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"input-container\"],\n\t\t\t\t\tchildren: [{\n\t\t\t\t\t\ttag: \"input\",\n\t\t\t\t\t\tclassList: [\"prompt-input\"],\n\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\t\tplaceholder: this.defaultText.placeholder\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"div\",\n\t\t\t\t\t\tclassList: [\"cta\"]\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"commands-containers\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"instructions\"],\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: \"div\",\n\t\t\t\t\t\t\tclassList: [\"instruction\"],\n\t\t\t\t\t\t\tchildren: [{\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tclassList: [\"key\"],\n\t\t\t\t\t\t\t\tproperties: { innerText: \"\u2191\u2193\" }\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tproperties: { innerText: \"to navigate\" }\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: \"div\",\n\t\t\t\t\t\t\tclassList: [\"instruction\"],\n\t\t\t\t\t\t\tchildren: [{\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tclassList: [\"key\"],\n\t\t\t\t\t\t\t\tproperties: { innerText: \"enter\" }\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tproperties: { innerText: \"to trigger\" }\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: \"div\",\n\t\t\t\t\t\t\tclassList: [\"instruction\"],\n\t\t\t\t\t\t\tchildren: [{\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tclassList: [\"key\"],\n\t\t\t\t\t\t\t\tproperties: { innerText: \"esc\" }\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\t\t\tproperties: { innerText: \"to exit\" }\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}));\n\t\tthis.inputNode = this.promptNode.querySelector(\"input\");\n\t\tthis.document.documentElement.appendChild(this.promptNode);\n\t}\n\t/**\n\t* Show commands in a new `commandsContainer`\n\t* All other `commandsContainer` is hidden\n\t* @param commands Command[]\n\t* @param clear remove all `commandsContainer` if true\n\t*/\n\tshowCommands(commands, clear = false) {\n\t\tif (clear) this.promptNode.querySelectorAll(\".commands-container\").forEach((e) => e.remove());\n\t\tthis.inputNode.placeholder = this.defaultText.placeholder;\n\t\tconst commandsContainer = this.createCommandsContainer();\n\t\tfor (const command of commands) {\n\t\t\t/**\n\t\t\t* Filter out anonymous commands\n\t\t\t*/\n\t\t\ttry {\n\t\t\t\tif (!command.name || command.when && !command.when()) continue;\n\t\t\t} catch {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tcommandsContainer.appendChild(this.createCommandNode(command));\n\t\t}\n\t}\n\t/**\n\t* Create a `commandsContainer` div element, append to `commandsContainer` and hide others.\n\t* @returns commandsNode\n\t*/\n\tcreateCommandsContainer() {\n\t\tconst commandsContainer = this.ui.createElement(this.document, \"div\", { classList: [\"commands-container\"] });\n\t\tthis.promptNode.querySelectorAll(\".commands-container\").forEach((e) => {\n\t\t\te.style.display = \"none\";\n\t\t});\n\t\tthis.promptNode.querySelector(\".commands-containers\").appendChild(commandsContainer);\n\t\treturn commandsContainer;\n\t}\n\t/**\n\t* Return current displayed `commandsContainer`\n\t* @returns\n\t*/\n\tgetCommandsContainer() {\n\t\treturn [...Array.from(this.promptNode.querySelectorAll(\".commands-container\"))].find((e) => {\n\t\t\treturn e.style.display !== \"none\";\n\t\t});\n\t}\n\t/**\n\t* Create a command item for `Prompt` UI.\n\t* @param command\n\t* @returns\n\t*/\n\tcreateCommandNode(command) {\n\t\tconst commandNode = this.ui.createElement(this.document, \"div\", {\n\t\t\tclassList: [\"command\"],\n\t\t\tchildren: [{\n\t\t\t\ttag: \"div\",\n\t\t\t\tclassList: [\"content\"],\n\t\t\t\tchildren: [{\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"name\"],\n\t\t\t\t\tchildren: [{\n\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\tproperties: { innerText: command.name }\n\t\t\t\t\t}]\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"div\",\n\t\t\t\t\tclassList: [\"aux\"],\n\t\t\t\t\tchildren: command.label ? [{\n\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\tclassList: [\"label\"],\n\t\t\t\t\t\tproperties: { innerText: command.label }\n\t\t\t\t\t}] : []\n\t\t\t\t}]\n\t\t\t}],\n\t\t\tlisteners: [{\n\t\t\t\ttype: \"mousemove\",\n\t\t\t\tlistener: () => {\n\t\t\t\t\tthis.selectItem(commandNode);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\ttype: \"click\",\n\t\t\t\tlistener: async () => {\n\t\t\t\t\tawait this.execCallback(command.callback);\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t\tcommandNode.command = command;\n\t\treturn commandNode;\n\t}\n\t/**\n\t* Called when `enter` key is pressed.\n\t*/\n\ttrigger() {\n\t\t[...Array.from(this.promptNode.querySelectorAll(\".commands-container\"))].find((e) => e.style.display !== \"none\").querySelector(\".selected\").click();\n\t}\n\t/**\n\t* Called when `escape` key is pressed.\n\t*/\n\texit() {\n\t\tthis.inputNode.placeholder = this.defaultText.placeholder;\n\t\tif (this.promptNode.querySelectorAll(\".commands-containers .commands-container\").length >= 2) {\n\t\t\tthis.promptNode.querySelector(\".commands-container:last-child\").remove();\n\t\t\tconst commandsContainer = this.promptNode.querySelector(\".commands-container:last-child\");\n\t\t\tcommandsContainer.style.display = \"\";\n\t\t\tcommandsContainer.querySelectorAll(\".commands\").forEach((e) => e.style.display = \"flex\");\n\t\t\tthis.inputNode.focus();\n\t\t} else this.promptNode.style.display = \"none\";\n\t}\n\tasync execCallback(callback) {\n\t\tif (Array.isArray(callback)) this.showCommands(callback);\n\t\telse await callback(this);\n\t}\n\t/**\n\t* Match suggestions for user's entered text.\n\t*/\n\tasync showSuggestions(inputText) {\n\t\tconst _w = /[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,\\-./:;<=>?@[\\]^_`{|}~]/;\n\t\tconst jw = /\\s/;\n\t\tconst Ww = /[\\u0F00-\\u0FFF\\u3040-\\u30FF\\u3400-\\u4DBF\\u4E00-\\u9FFF\\uF900-\\uFAFF\\uFF66-\\uFF9F]/;\n\t\tfunction Yw(e$1, t, n, i) {\n\t\t\tif (e$1.length === 0) return 0;\n\t\t\tlet r = 0;\n\t\t\tr -= Math.max(0, e$1.length - 1), r -= i / 10;\n\t\t\tconst o = e$1[0][0];\n\t\t\treturn r -= (e$1[e$1.length - 1][1] - o + 1 - t) / 100, r -= o / 1e3, r -= n / 1e4;\n\t\t}\n\t\tfunction $w(e$1, t, n, i) {\n\t\t\tif (e$1.length === 0) return null;\n\t\t\tfor (var r = n.toLowerCase(), o = 0, a = 0, s = [], l = 0; l < e$1.length; l++) {\n\t\t\t\tconst c = e$1[l];\n\t\t\t\tconst u = r.indexOf(c, a);\n\t\t\t\tif (u === -1) return null;\n\t\t\t\tconst h = n.charAt(u);\n\t\t\t\tif (u > 0 && !_w.test(h) && !Ww.test(h)) {\n\t\t\t\t\tconst p = n.charAt(u - 1);\n\t\t\t\t\tif (h.toLowerCase() !== h && p.toLowerCase() !== p || h.toUpperCase() !== h && !_w.test(p) && !jw.test(p) && !Ww.test(p)) if (i) {\n\t\t\t\t\t\tif (u !== a) {\n\t\t\t\t\t\t\ta += c.length, l--;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else o += 1;\n\t\t\t\t}\n\t\t\t\tif (s.length === 0) s.push([u, u + c.length]);\n\t\t\t\telse {\n\t\t\t\t\tconst d = s[s.length - 1];\n\t\t\t\t\td[1] < u ? s.push([u, u + c.length]) : d[1] = u + c.length;\n\t\t\t\t}\n\t\t\t\ta = u + c.length;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tmatches: s,\n\t\t\t\tscore: Yw(s, t.length, r.length, o)\n\t\t\t};\n\t\t}\n\t\tfunction Gw(e$1) {\n\t\t\tfor (var t = e$1.toLowerCase(), n = [], i = 0, r = 0; r < t.length; r++) {\n\t\t\t\tconst o = t.charAt(r);\n\t\t\t\tjw.test(o) ? (i !== r && n.push(t.substring(i, r)), i = r + 1) : (_w.test(o) || Ww.test(o)) && (i !== r && n.push(t.substring(i, r)), n.push(o), i = r + 1);\n\t\t\t}\n\t\t\treturn i !== t.length && n.push(t.substring(i, t.length)), {\n\t\t\t\tquery: e$1,\n\t\t\t\ttokens: n,\n\t\t\t\tfuzzy: t.split(\"\")\n\t\t\t};\n\t\t}\n\t\tfunction Xw(e$1, t) {\n\t\t\tif (e$1.query === \"\") return {\n\t\t\t\tscore: 0,\n\t\t\t\tmatches: []\n\t\t\t};\n\t\t\tconst n = $w(e$1.tokens, e$1.query, t, !1);\n\t\t\treturn n || $w(e$1.fuzzy, e$1.query, t, !0);\n\t\t}\n\t\tconst e = Gw(inputText);\n\t\tlet container = this.getCommandsContainer();\n\t\tif (container.classList.contains(\"suggestions\")) this.exit();\n\t\tif (inputText.trim() == \"\") return true;\n\t\tconst suggestions = [];\n\t\tthis.getCommandsContainer().querySelectorAll(\".command\").forEach((commandNode) => {\n\t\t\tconst spanNode = commandNode.querySelector(\".name span\");\n\t\t\tconst spanText = spanNode.innerText;\n\t\t\tconst res = Xw(e, spanText);\n\t\t\tif (res) {\n\t\t\t\tcommandNode = this.createCommandNode(commandNode.command);\n\t\t\t\tlet spanHTML = \"\";\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (let j = 0; j < res.matches.length; j++) {\n\t\t\t\t\tconst [start, end] = res.matches[j];\n\t\t\t\t\tif (start > i) spanHTML += spanText.slice(i, start);\n\t\t\t\t\tspanHTML += `<span class=\"highlight\">${spanText.slice(start, end)}</span>`;\n\t\t\t\t\ti = end;\n\t\t\t\t}\n\t\t\t\tif (i < spanText.length) spanHTML += spanText.slice(i, spanText.length);\n\t\t\t\tcommandNode.querySelector(\".name span\").innerHTML = spanHTML;\n\t\t\t\tsuggestions.push({\n\t\t\t\t\tscore: res.score,\n\t\t\t\t\tcommandNode\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (suggestions.length > 0) {\n\t\t\tsuggestions.sort((a, b) => b.score - a.score).slice(this.maxSuggestionNum);\n\t\t\tcontainer = this.createCommandsContainer();\n\t\t\tcontainer.classList.add(\"suggestions\");\n\t\t\tsuggestions.forEach((suggestion) => {\n\t\t\t\tcontainer.appendChild(suggestion.commandNode);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconst anonymousCommand = this.commands.find((c) => !c.name && (!c.when || c.when()));\n\t\t\tif (anonymousCommand) await this.execCallback(anonymousCommand.callback);\n\t\t\telse this.showTip(this.defaultText.empty);\n\t\t\treturn false;\n\t\t}\n\t}\n\t/**\n\t* Bind events of pressing `keydown` and `keyup` key.\n\t*/\n\tinitInputEvents() {\n\t\tthis.promptNode.addEventListener(\"keydown\", (event) => {\n\t\t\tif ([\"ArrowUp\", \"ArrowDown\"].includes(event.key)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet selectedIndex;\n\t\t\t\tconst allItems = [...Array.from(this.getCommandsContainer().querySelectorAll(\".command\"))].filter((e) => e.style.display != \"none\");\n\t\t\t\tselectedIndex = allItems.findIndex((e) => e.classList.contains(\"selected\"));\n\t\t\t\tif (selectedIndex != -1) {\n\t\t\t\t\tallItems[selectedIndex].classList.remove(\"selected\");\n\t\t\t\t\tselectedIndex += event.key == \"ArrowUp\" ? -1 : 1;\n\t\t\t\t} else if (event.key == \"ArrowUp\") selectedIndex = allItems.length - 1;\n\t\t\t\telse selectedIndex = 0;\n\t\t\t\tif (selectedIndex == -1) selectedIndex = allItems.length - 1;\n\t\t\t\telse if (selectedIndex == allItems.length) selectedIndex = 0;\n\t\t\t\tallItems[selectedIndex].classList.add(\"selected\");\n\t\t\t\tconst commandsContainer = this.getCommandsContainer();\n\t\t\t\tcommandsContainer.scrollTo(0, commandsContainer.querySelector(\".selected\").offsetTop - commandsContainer.offsetHeight + 7.5);\n\t\t\t\tallItems[selectedIndex].classList.add(\"selected\");\n\t\t\t}\n\t\t});\n\t\tthis.promptNode.addEventListener(\"keyup\", async (event) => {\n\t\t\tif (event.key == \"Enter\") this.trigger();\n\t\t\telse if (event.key == \"Escape\") if (this.inputNode.value.length > 0) this.inputNode.value = \"\";\n\t\t\telse this.exit();\n\t\t\telse if ([\"ArrowUp\", \"ArrowDown\"].includes(event.key)) return;\n\t\t\tconst currentInputText = this.inputNode.value;\n\t\t\tif (currentInputText == this.lastInputText) return;\n\t\t\tthis.lastInputText = currentInputText;\n\t\t\twindow.setTimeout(async () => {\n\t\t\t\tawait this.showSuggestions(currentInputText);\n\t\t\t});\n\t\t});\n\t}\n\t/**\n\t* Create a commandsContainer and display a text\n\t*/\n\tshowTip(text) {\n\t\tconst tipNode = this.ui.createElement(this.document, \"div\", {\n\t\t\tclassList: [\"tip\"],\n\t\t\tproperties: { innerText: text }\n\t\t});\n\t\tconst container = this.createCommandsContainer();\n\t\tcontainer.classList.add(\"suggestions\");\n\t\tcontainer.appendChild(tipNode);\n\t\treturn tipNode;\n\t}\n\t/**\n\t* Mark the selected item with class `selected`.\n\t* @param item HTMLDivElement\n\t*/\n\tselectItem(item) {\n\t\tthis.getCommandsContainer().querySelectorAll(\".command\").forEach((e) => e.classList.remove(\"selected\"));\n\t\titem.classList.add(\"selected\");\n\t}\n\taddStyle() {\n\t\tconst style$1 = this.ui.createElement(this.document, \"style\", {\n\t\t\tnamespace: \"html\",\n\t\t\tid: \"prompt-style\"\n\t\t});\n\t\tstyle$1.innerText = `\n      .prompt-container * {\n        box-sizing: border-box;\n      }\n      .prompt-container {\n        ---radius---: 10px;\n        position: fixed;\n        left: 25%;\n        top: 10%;\n        width: 50%;\n        border-radius: var(---radius---);\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        font-size: 18px;\n        box-shadow: 0px 1.8px 7.3px rgba(0, 0, 0, 0.071),\n                    0px 6.3px 24.7px rgba(0, 0, 0, 0.112),\n                    0px 30px 90px rgba(0, 0, 0, 0.2);\n        font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Inter\", \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Microsoft YaHei Light\", sans-serif;\n        background-color: var(--material-background) !important;\n        border: var(--material-border-quarternary) !important;\n      }\n      \n      /* input */\n      .prompt-container .input-container  {\n        width: 100%;\n      }\n\n      .input-container input {\n        width: -moz-available;\n        height: 40px;\n        padding: 24px;\n        border: none;\n        outline: none;\n        font-size: 18px;\n        margin: 0 !important;\n        border-radius: var(---radius---);\n        background-color: var(--material-background);\n      }\n      \n      .input-container .cta {\n        border-bottom: var(--material-border-quarternary);\n        margin: 5px auto;\n      }\n      \n      /* results */\n      .commands-containers {\n        width: 100%;\n        height: 100%;\n      }\n      .commands-container {\n        max-height: calc(${this.maxLineNum} * 35.5px);\n        width: calc(100% - 12px);\n        margin-left: 12px;\n        margin-right: 0%;\n        overflow-y: auto;\n        overflow-x: hidden;\n      }\n      \n      .commands-container .command {\n        display: flex;\n        align-content: baseline;\n        justify-content: space-between;\n        border-radius: 5px;\n        padding: 6px 12px;\n        margin-right: 12px;\n        margin-top: 2px;\n        margin-bottom: 2px;\n      }\n      .commands-container .command .content {\n        display: flex;\n        width: 100%;\n        justify-content: space-between;\n        flex-direction: row;\n        overflow: hidden;\n      }\n      .commands-container .command .content .name {\n        white-space: nowrap; \n        text-overflow: ellipsis;\n        overflow: hidden;\n      }\n      .commands-container .command .content .aux {\n        display: flex;\n        align-items: center;\n        align-self: center;\n        flex-shrink: 0;\n      }\n      \n      .commands-container .command .content .aux .label {\n        font-size: 15px;\n        color: var(--fill-primary);\n        padding: 2px 6px;\n        background-color: var(--color-background);\n        border-radius: 5px;\n      }\n      \n      .commands-container .selected {\n          background-color: var(--material-mix-quinary);\n      }\n\n      .commands-container .highlight {\n        font-weight: bold;\n      }\n\n      .tip {\n        color: var(--fill-primary);\n        text-align: center;\n        padding: 12px 12px;\n        font-size: 18px;\n      }\n\n      /* instructions */\n      .instructions {\n        display: flex;\n        align-content: center;\n        justify-content: center;\n        font-size: 15px;\n        height: 2.5em;\n        width: 100%;\n        border-top: var(--material-border-quarternary);\n        color: var(--fill-secondary);\n        margin-top: 5px;\n      }\n      \n      .instructions .instruction {\n        margin: auto .5em;  \n      }\n      \n      .instructions .key {\n        margin-right: .2em;\n        font-weight: 600;\n      }\n    `;\n\t\tthis.document.documentElement.appendChild(style$1);\n\t}\n\tregisterShortcut() {\n\t\tthis.document.addEventListener(\"keydown\", (event) => {\n\t\t\tif (event.shiftKey && event.key.toLowerCase() == \"p\") {\n\t\t\t\tif (event.originalTarget.isContentEditable || \"value\" in event.originalTarget || this.commands.length == 0) return;\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tif (this.promptNode.style.display == \"none\") {\n\t\t\t\t\tthis.promptNode.style.display = \"flex\";\n\t\t\t\t\tif (this.promptNode.querySelectorAll(\".commands-container\").length == 1) this.showCommands(this.commands, true);\n\t\t\t\t\tthis.promptNode.focus();\n\t\t\t\t\tthis.inputNode.focus();\n\t\t\t\t} else this.promptNode.style.display = \"none\";\n\t\t\t}\n\t\t}, true);\n\t}\n};\nvar PromptManager = class extends ManagerTool {\n\tprompt;\n\t/**\n\t* Save the commands registered from this manager\n\t*/\n\tcommands = [];\n\tconstructor(base) {\n\t\tsuper(base);\n\t\tconst globalCache = toolkitGlobal_default.getInstance()?.prompt;\n\t\tif (!globalCache) throw new Error(\"Prompt is not initialized.\");\n\t\tif (!globalCache._ready) {\n\t\t\tglobalCache._ready = true;\n\t\t\tglobalCache.instance = new Prompt();\n\t\t}\n\t\tthis.prompt = globalCache.instance;\n\t}\n\t/**\n\t* Register commands. Don't forget to call `unregister` on plugin exit.\n\t* @param commands Command[]\n\t* @example\n\t* ```ts\n\t* let getReader = () => {\n\t*   return BasicTool.getZotero().Reader.getByTabID(\n\t*     (Zotero.getMainWindow().Zotero_Tabs).selectedID\n\t*   )\n\t* }\n\t*\n\t* register([\n\t*   {\n\t*     name: \"Split Horizontally\",\n\t*     label: \"Zotero\",\n\t*     when: () => getReader() as boolean,\n\t*     callback: (prompt: Prompt) => getReader().menuCmd(\"splitHorizontally\")\n\t*   },\n\t*   {\n\t*     name: \"Split Vertically\",\n\t*     label: \"Zotero\",\n\t*     when: () => getReader() as boolean,\n\t*     callback: (prompt: Prompt) => getReader().menuCmd(\"splitVertically\")\n\t*   }\n\t* ])\n\t* ```\n\t*/\n\tregister(commands) {\n\t\tcommands.forEach((c) => c.id ??= c.name);\n\t\tthis.prompt.commands = [...this.prompt.commands, ...commands];\n\t\tthis.commands = [...this.commands, ...commands];\n\t\tthis.prompt.showCommands(this.commands, true);\n\t}\n\t/**\n\t* You can delete a command registed before by its name.\n\t* @remarks\n\t* There is a premise here that the names of all commands registered by a single plugin are not duplicated.\n\t* @param id Command.name\n\t*/\n\tunregister(id) {\n\t\tthis.prompt.commands = this.prompt.commands.filter((c) => c.id != id);\n\t\tthis.commands = this.commands.filter((c) => c.id != id);\n\t}\n\t/**\n\t* Call `unregisterAll` on plugin exit.\n\t*/\n\tunregisterAll() {\n\t\tthis.prompt.commands = this.prompt.commands.filter((c) => {\n\t\t\treturn this.commands.every((_c) => _c.id != c.id);\n\t\t});\n\t\tthis.commands = [];\n\t}\n};\n\n//#endregion\n//#region src/tools/extraField.ts\n/**\n* Get/set extra field APIs.\n*/\nvar ExtraFieldTool = class extends BasicTool {\n\tgetExtraFields(item, parser = \"enhanced\") {\n\t\tconst extraFiledRaw = item.getField(\"extra\");\n\t\tif (parser === \"classical\") return this.getGlobal(\"Zotero\").Utilities.Internal.extractExtraFields(extraFiledRaw).fields;\n\t\telse {\n\t\t\tconst map = /* @__PURE__ */ new Map();\n\t\t\tconst nonStandardFields = [];\n\t\t\textraFiledRaw.split(\"\\n\").forEach((line) => {\n\t\t\t\tif (!line) return;\n\t\t\t\tconst split = line.split(\": \");\n\t\t\t\tif (split.length >= 2 && split[0]) {\n\t\t\t\t\tconst key = split[0];\n\t\t\t\t\tconst value = split.slice(1).join(\": \");\n\t\t\t\t\tif (!map.has(key)) map.set(key, []);\n\t\t\t\t\tmap.get(key).push(value);\n\t\t\t\t} else nonStandardFields.push(line);\n\t\t\t});\n\t\t\tif (nonStandardFields.length > 0) map.set(\"__nonStandard__\", [nonStandardFields.join(\"\\n\")]);\n\t\t\treturn map;\n\t\t}\n\t}\n\tgetExtraField(item, key, all = false) {\n\t\tconst fields = this.getExtraFields(item, \"enhanced\");\n\t\tconst values = fields.get(key);\n\t\tif (!values) return void 0;\n\t\treturn all ? values : values[0];\n\t}\n\t/**\n\t* Replace extra field of an item.\n\t* @param item\n\t* @param fields\n\t* @param [options] Additional options.\n\t* @param [options.save] Whether to save the item, default to true.\n\t*/\n\tasync replaceExtraFields(item, fields, options = {}) {\n\t\tconst { save = true } = options;\n\t\tconst kvs = [];\n\t\tif (fields.has(\"__nonStandard__\")) {\n\t\t\tkvs.push(...fields.get(\"__nonStandard__\"));\n\t\t\tfields.delete(\"__nonStandard__\");\n\t\t}\n\t\tfields.forEach((values, key) => {\n\t\t\tvalues.forEach((v) => kvs.push(`${key}: ${v}`));\n\t\t});\n\t\titem.setField(\"extra\", kvs.join(\"\\n\"));\n\t\tif (save) await item.saveTx();\n\t}\n\t/**\n\t* Set a key-value pair in the item's extra field.\n\t* If the key already exists, it can be overwritten or appended.\n\t* @param item Zotero item\n\t* @param key Field key\n\t* @param value Field value or list of values\n\t* @param options Additional options\n\t* @param [options.append] Whether to append to existing values, default to false\n\t* @param [options.save] Whether to save the item, default to true\n\t*/\n\tasync setExtraField(item, key, value, options = {}) {\n\t\tconst { append = false, save = true } = options;\n\t\tconst fields = this.getExtraFields(item, \"enhanced\");\n\t\tif (value === \"\" || typeof value === \"undefined\") fields.delete(key);\n\t\telse {\n\t\t\tconst values = Array.isArray(value) ? value : [value];\n\t\t\tif (append && fields.has(key)) fields.get(key).push(...values);\n\t\t\telse fields.set(key, values);\n\t\t}\n\t\tawait this.replaceExtraFields(item, fields, { save });\n\t}\n};\n\n//#endregion\n//#region src/tools/reader.ts\n/**\n* Zotero ReaderInstance APIs.\n*/\nvar ReaderTool = class extends BasicTool {\n\t/**\n\t* Get the selected tab reader.\n\t* @param waitTime Wait for n MS until the reader is ready\n\t*/\n\tasync getReader(waitTime = 5e3) {\n\t\tconst Zotero_Tabs = this.getGlobal(\"Zotero_Tabs\");\n\t\tif (Zotero_Tabs.selectedType !== \"reader\") return void 0;\n\t\tlet reader = Zotero.Reader.getByTabID(Zotero_Tabs.selectedID);\n\t\tlet delayCount = 0;\n\t\tconst checkPeriod = 50;\n\t\twhile (!reader && delayCount * checkPeriod < waitTime) {\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, checkPeriod));\n\t\t\treader = Zotero.Reader.getByTabID(Zotero_Tabs.selectedID);\n\t\t\tdelayCount++;\n\t\t}\n\t\tawait reader?._initPromise;\n\t\treturn reader;\n\t}\n\t/**\n\t* Get all window readers.\n\t*/\n\tgetWindowReader() {\n\t\tconst Zotero_Tabs = this.getGlobal(\"Zotero_Tabs\");\n\t\tconst windowReaders = [];\n\t\tconst tabs = Zotero_Tabs._tabs.map((e) => e.id);\n\t\tfor (let i = 0; i < Zotero.Reader._readers.length; i++) {\n\t\t\tlet flag = false;\n\t\t\tfor (let j = 0; j < tabs.length; j++) if (Zotero.Reader._readers[i].tabID === tabs[j]) {\n\t\t\t\tflag = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!flag) windowReaders.push(Zotero.Reader._readers[i]);\n\t\t}\n\t\treturn windowReaders;\n\t}\n\t/**\n\t* Get Reader tabpanel deck element.\n\t* @deprecated - use item pane api\n\t* @alpha\n\t*/\n\tgetReaderTabPanelDeck() {\n\t\tconst deck = this.getGlobal(\"window\").document.querySelector(\".notes-pane-deck\")?.previousElementSibling;\n\t\treturn deck;\n\t}\n\t/**\n\t* Add a reader tabpanel deck selection change observer.\n\t* @deprecated - use item pane api\n\t* @alpha\n\t* @param callback\n\t*/\n\tasync addReaderTabPanelDeckObserver(callback) {\n\t\tawait waitUtilAsync(() => !!this.getReaderTabPanelDeck());\n\t\tconst deck = this.getReaderTabPanelDeck();\n\t\tconst observer = new (this.getGlobal(\"MutationObserver\"))(async (mutations) => {\n\t\t\tmutations.forEach(async (mutation) => {\n\t\t\t\tconst target = mutation.target;\n\t\t\t\tif (target.classList.contains(\"zotero-view-tabbox\") || target.tagName === \"deck\") callback();\n\t\t\t});\n\t\t});\n\t\tobserver.observe(deck, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"selectedIndex\"],\n\t\t\tsubtree: true\n\t\t});\n\t\treturn observer;\n\t}\n\t/**\n\t* Get the selected annotation data.\n\t* @param reader Target reader\n\t* @returns The selected annotation data.\n\t*/\n\tgetSelectedAnnotationData(reader) {\n\t\tconst annotation = reader?._internalReader._lastView._selectionPopup?.annotation;\n\t\treturn annotation;\n\t}\n\t/**\n\t* Get the text selection of reader.\n\t* @param reader Target reader\n\t* @returns The text selection of reader.\n\t*/\n\tgetSelectedText(reader) {\n\t\treturn this.getSelectedAnnotationData(reader)?.text ?? \"\";\n\t}\n};\n\n//#endregion\n//#region src/ztoolkit.ts\n/**\n* \u2B50Contains all tools in this lib. Start from here if you are new to this lib.\n* @remarks\n* To minimize your plugin, import the modules you need manually.\n*/\nvar ZoteroToolkit = class extends BasicTool {\n\tstatic _version = BasicTool._version;\n\tUI = new UITool(this);\n\tReader = new ReaderTool(this);\n\tExtraField = new ExtraFieldTool(this);\n\tFieldHooks = new FieldHookManager(this);\n\tKeyboard = new KeyboardManager(this);\n\tPrompt = new PromptManager(this);\n\tMenu = new MenuManager(this);\n\tClipboard = makeHelperTool(ClipboardHelper, this);\n\tFilePicker = makeHelperTool(FilePickerHelper, this);\n\tPatch = makeHelperTool(PatchHelper, this);\n\tProgressWindow = makeHelperTool(ProgressWindowHelper, this);\n\tVirtualizedTable = makeHelperTool(VirtualizedTableHelper, this);\n\tDialog = makeHelperTool(DialogHelper, this);\n\tLargePrefObject = makeHelperTool(LargePrefHelper, this);\n\tGuide = makeHelperTool(GuideHelper, this);\n\tconstructor() {\n\t\tsuper();\n\t}\n\t/**\n\t* Unregister everything created by managers.\n\t*/\n\tunregisterAll() {\n\t\tunregister(this);\n\t}\n};\n\n//#endregion\nexport { BasicTool, ClipboardHelper, DialogHelper, ExtraFieldTool, FieldHookManager, FilePickerHelper, GuideHelper, KeyModifier, KeyboardManager, LargePrefHelper, ManagerTool, MenuManager, MessageHelper, PatchHelper, ProgressWindowHelper, Prompt, PromptManager, ReaderTool, SettingsDialogHelper, UITool, VirtualizedTableHelper, ZoteroToolkit, _importESModule, makeHelperTool, unregister, wait_exports as wait };"],
  "mappings": "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,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,MAAM,qBAAqB;AAAA,IAC1B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,I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",
  "names": ["__defProp", "__export", "DebugBridge", "PluginBridge", "ToolkitGlobal", "BasicTool", "__export", "KeyModifier", "basicTool"]
}
